(this["webpackJsonp@epic/gltf-web-viewer"]=this["webpackJsonp@epic/gltf-web-viewer"]||[]).push([[0],{0:function(e,t){e.exports=React},20:function(e,t){e.exports=ReactDOM},3:function(e,t){e.exports=PropTypes},50:function(e,t){e.exports={defaultConfig:{assets:[],topbar:!0,sidebar:!0,cameras:!0,dragAndDrop:!0,topbarTitle:"Unreal glTF Viewer",topbarLogoUrl:"viewer/logo.svg",theme:{palette:{primary:"#3393FA"}}}}},8:function(e,t){e.exports=mobx},83:function(e,t,a){e.exports=a(99)},99:function(e,t,a){"use strict";a.r(t);var n=a(0),i=a.n(n),r=a(20),o=a(70),s=a(9),l=a.n(s),c=a(16),u=a(11),h=a(134),d=a(135),p=a(23),m=a(80),v=a(50);function f(e){var t;return Object(m.a)({palette:{type:"dark",text:{primary:"#FFFFFF",secondary:"#BBBBBD",disabled:"#93989F"},background:{default:"#1C1E22",paper:"#1C1E22"},divider:"#000000",action:{active:"#FFFFFF"},common:{black:"#000000",white:"#FFFFFF"},grey:{50:"#EFEFF0",100:"#EFEFF0",200:"#BBBBBD",300:"#93989F",400:"#464E59",500:"#2B323B",600:"#252B32",700:"#20262C",800:"#1D2126",900:"#1C1E22"},primary:{main:null!==(t=null==e?void 0:e.palette.primary)&&void 0!==t?t:v.defaultConfig.theme.palette.primary}},typography:{fontFamily:"'Open Sans', 'Helvetica', 'Arial', sans-serif",fontWeightBold:700,fontWeightMedium:600,fontWeightRegular:400,fontWeightLight:300,fontSize:12},topbarHeight:52,sidebarWidth:340,cameraPreviewWidth:96,cameraPreviewHeight:60,listAnimationDelay:25})}var g,b,y,_,k,C,w,O,E,S,x,P,M,j,L,D,T,A,R,I,F,V=a(6),z=a(22),B=a(7),U=a(10),N=(a(63),a(8)),H=(g=N.action.bound,b=N.action.bound,y=N.action.bound,_=N.action.bound,k=N.action.bound,C=function(){function e(){Object(V.a)(this,e),this.defaultGltf=void 0,Object(z.a)(this,"gltfs",w,this),Object(z.a)(this,"gltf",O,this),Object(z.a)(this,"sceneHierarchy",E,this),Object(z.a)(this,"camera",S,this),Object(z.a)(this,"levelVariantSetId",x,this);var t=new URLSearchParams(window.location.search);this.defaultGltf=t.get("gltf")}return Object(B.a)(e,[{key:"variantSetManager",get:function(){var e;return null===(e=this.sceneHierarchy)||void 0===e?void 0:e.variantSetManager}},{key:"cameras",get:function(){var e,t;return null!==(e=null===(t=this.sceneHierarchy)||void 0===t?void 0:t.cameras)&&void 0!==e?e:[]}},{key:"hasBackdrops",get:function(){var e,t;return null!==(e=null===(t=this.sceneHierarchy)||void 0===t?void 0:t.hasBackdrops)&&void 0!==e&&e}},{key:"setGltf",value:function(e){this.gltf=e}},{key:"setCamera",value:function(e){this.camera=e}},{key:"showLevelVariantSet",value:function(e){this.levelVariantSetId=e}},{key:"setGltfs",value:function(e){var t=this;this.gltfs=e,!this.gltf&&e.length>0&&(this.defaultGltf?this.setGltf(e.find((function(e){return e.name===t.defaultGltf}))):1===e.length&&this.setGltf(e[0]))}},{key:"setSceneHierarchy",value:function(e){this.camera=null==e?void 0:e.cameras[0],this.sceneHierarchy=e,this.levelVariantSetId=void 0}}]),e}(),w=Object(U.a)(C.prototype,"gltfs",[N.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),O=Object(U.a)(C.prototype,"gltf",[N.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),E=Object(U.a)(C.prototype,"sceneHierarchy",[N.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),S=Object(U.a)(C.prototype,"camera",[N.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),x=Object(U.a)(C.prototype,"levelVariantSetId",[N.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Object(U.a)(C.prototype,"variantSetManager",[N.computed],Object.getOwnPropertyDescriptor(C.prototype,"variantSetManager"),C.prototype),Object(U.a)(C.prototype,"cameras",[N.computed],Object.getOwnPropertyDescriptor(C.prototype,"cameras"),C.prototype),Object(U.a)(C.prototype,"hasBackdrops",[N.computed],Object.getOwnPropertyDescriptor(C.prototype,"hasBackdrops"),C.prototype),Object(U.a)(C.prototype,"setGltf",[g],Object.getOwnPropertyDescriptor(C.prototype,"setGltf"),C.prototype),Object(U.a)(C.prototype,"setCamera",[b],Object.getOwnPropertyDescriptor(C.prototype,"setCamera"),C.prototype),Object(U.a)(C.prototype,"showLevelVariantSet",[y],Object.getOwnPropertyDescriptor(C.prototype,"showLevelVariantSet"),C.prototype),Object(U.a)(C.prototype,"setGltfs",[_],Object.getOwnPropertyDescriptor(C.prototype,"setGltfs"),C.prototype),Object(U.a)(C.prototype,"setSceneHierarchy",[k],Object.getOwnPropertyDescriptor(C.prototype,"setSceneHierarchy"),C.prototype),C),W=(P=N.action.bound,M=function(){function e(){Object(V.a)(this,e),Object(z.a)(this,"_showFpsMeter",j,this),Object(z.a)(this,"_showTopbar",L,this),Object(z.a)(this,"_showSidebar",D,this),Object(z.a)(this,"_showCameras",T,this),Object(z.a)(this,"enableDragAndDrop",A,this),Object(z.a)(this,"topbarTitle",R,this),Object(z.a)(this,"topbarLogoUrl",I,this),Object(z.a)(this,"showUI",F,this);var t=new URLSearchParams(window.location.search);this.showUI=!t.get("hideUI"),this._showFpsMeter=!!t.get("showFpsMeter")}return Object(B.a)(e,[{key:"showTopbar",get:function(){return this.showUI&&this._showTopbar}},{key:"showSidebar",get:function(){return this.showUI&&this._showSidebar}},{key:"showCameras",get:function(){return this.showUI&&this._showCameras}},{key:"showFpsMeter",get:function(){return this.showUI&&this._showFpsMeter}},{key:"initFromConfig",value:function(e){this.enableDragAndDrop=e.dragAndDrop,this.topbarTitle=e.topbarTitle,this.topbarLogoUrl=e.topbarLogoUrl,this._showTopbar=e.topbar,this._showSidebar=e.sidebar,this._showCameras=e.cameras}}]),e}(),j=Object(U.a)(M.prototype,"_showFpsMeter",[N.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),L=Object(U.a)(M.prototype,"_showTopbar",[N.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),D=Object(U.a)(M.prototype,"_showSidebar",[N.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),T=Object(U.a)(M.prototype,"_showCameras",[N.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),A=Object(U.a)(M.prototype,"enableDragAndDrop",[N.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),R=Object(U.a)(M.prototype,"topbarTitle",[N.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),I=Object(U.a)(M.prototype,"topbarLogoUrl",[N.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),F=Object(U.a)(M.prototype,"showUI",[N.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Object(U.a)(M.prototype,"showTopbar",[N.computed],Object.getOwnPropertyDescriptor(M.prototype,"showTopbar"),M.prototype),Object(U.a)(M.prototype,"showSidebar",[N.computed],Object.getOwnPropertyDescriptor(M.prototype,"showSidebar"),M.prototype),Object(U.a)(M.prototype,"showCameras",[N.computed],Object.getOwnPropertyDescriptor(M.prototype,"showCameras"),M.prototype),Object(U.a)(M.prototype,"showFpsMeter",[N.computed],Object.getOwnPropertyDescriptor(M.prototype,"showFpsMeter"),M.prototype),Object(U.a)(M.prototype,"initFromConfig",[P],Object.getOwnPropertyDescriptor(M.prototype,"initFromConfig"),M.prototype),M),G=function e(){Object(V.a)(this,e),this.gltfStore=new H,this.settingsStore=new W},Z=Object(n.createContext)({}),Y=function(e){var t=e.children;return i.a.createElement(Z.Provider,{value:new G},t)},q=function(){return Object(n.useContext)(Z)},X=function(){var e=function(){var e=Object(n.useState)(0),t=Object(u.a)(e,2),a=t[0],i=t[1];return[a>0,Object(n.useCallback)((function(){return i((function(e){return e+1}))}),[]),Object(n.useCallback)((function(){return i((function(e){return e-1}))}),[])]}(),t=Object(u.a)(e,3),a=t[0],i=t[1],r=t[2],o=Object(n.useState)(!1),s=Object(u.a)(o,2),h=s[0],d=s[1];return[a,h,Object(n.useCallback)(function(){var e=Object(c.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return d(!1),i(),e.prev=2,e.next=5,t();case 5:e.next=12;break;case 7:throw e.prev=7,e.t0=e.catch(2),d(!0),r(),e.t0;case 12:r();case 13:case"end":return e.stop()}}),e,null,[[2,7]])})));return function(t){return e.apply(this,arguments)}}(),[i,r,d])]},Q=a(37),$=a.n(Q),K=a(81);function J(e,t){return new Promise((function(a,n){var i=new FileReader;switch(i.onabort=function(){return n("File reading was aborted")},i.onerror=function(){return n("File reading has failed")},i.onload=function(){return a(i.result)},t){case"arrayBuffer":i.readAsArrayBuffer(e);break;case"dataURL":i.readAsDataURL(e);break;default:i.readAsText(e)}}))}function ee(e,t){return te.apply(this,arguments)}function te(){return(te=Object(c.a)(l.a.mark((function e(t,a){var n,i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,J(t,"text");case 2:if(n=e.sent){e.next=5;break}return e.abrupt("return",void 0);case 5:return i=a.reduce((function(e,t){var a=URL.createObjectURL(t).split("/"),n=a[a.length-1],i=t.name.replace(/\./g,"\\."),r=new RegExp('"(?:[^"]+)"\\s*:\\s*"(([^"]+[\\/\\\\])?'.concat(i,')",?'),"g");return e.replace(r,(function(e,t){return e.replace(t,n)}))}),n),e.abrupt("return",new Blob([i]));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ae(e){return!!$.a.extname(e.name).match(/\.(gltf|glb)$/)}var ne=a(75),ie=a.n(ne);function re(){return oe.apply(this,arguments)}function oe(){return(oe=Object(c.a)(l.a.mark((function e(){var t,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("index.json");case 3:return t=e.sent,e.next=6,t.json();case 6:return a=e.sent,e.abrupt("return",ie()(v.defaultConfig,a));case 10:e.prev=10,e.t0=e.catch(0);case 12:return e.abrupt("return",v.defaultConfig);case 13:case"end":return e.stop()}}),e,null,[[0,10]])})))).apply(this,arguments)}var se=a(61);function le(e,t,a){return e*=a,t*=1-a,Math.round(e+t)}function ce(e,t,a){a=Math.min(Math.max(0,a),1);var n=Object(se.decomposeColor)(e),i=Object(se.decomposeColor)(t);if(n.type!==i.type)throw new Error("Cannot mix colors of different formats.");if(["rgba","hsla"].includes(n.type)||["rgba","hsla"].includes(i.type))throw new Error("Cannot mix colors with alpha channel.");var r={type:n.type,values:[le(n.values[0],i.values[0],a),le(n.values[1],i.values[1],a),le(n.values[2],i.values[2],a)]};return Object(se.recomposeColor)(r)}var ue,he,de,pe,me,ve,fe=a(15),ge=a(5),be=a(125),ye=a(24),_e=a(133),ke=a(127),Ce=a(137),we=Object(be.a)((function(e){var t={opacity:1,transform:"translate3d(0, 0, 0)"};return{"@keyframes default":{from:{opacity:0},to:{opacity:1}},"@keyframes slideInLeft":{from:{opacity:0,transform:"translate3d(".concat("100px",", 0, 0)")},to:t},"@keyframes slideInRight":{from:{opacity:0,transform:"translate3d(-".concat("100px",", 0, 0)")},to:t},"@keyframes slideInUp":{from:{opacity:0,transform:"translate3d(0, ".concat("100px",", 0)")},to:t},"@keyframes slideInDown":{from:{opacity:0,transform:"translate3d(0, -".concat("100px",", 0)")},to:t},root:{opacity:0,animationName:"$default",animationFillMode:"forwards",animationTimingFunction:e.transitions.easing.easeOut,animationDuration:"".concat(e.transitions.duration.enteringScreen,"ms")},left:{animationName:"$slideInLeft"},right:{animationName:"$slideInRight"},up:{animationName:"$slideInUp"},down:{animationName:"$slideInDown"}}})),Oe=function(e){var t,a=e.children,n=e.direction,r=e.duration,o=e.delay,s=we();return i.a.createElement("div",{className:Object(ge.a)(s.root,(t={},Object(fe.a)(t,s.left,"left"===n),Object(fe.a)(t,s.right,"right"===n),Object(fe.a)(t,s.up,"up"===n),Object(fe.a)(t,s.down,"down"===n),t)),style:{animationDuration:r?"".concat(r,"ms"):void 0,animationDelay:o?"".concat(o,"ms"):void 0}},a)},Ee=a(126),Se=["svgRef","title"];function xe(){return(xe=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function Pe(e,t){if(null==e)return{};var a,n,i=function(e,t){if(null==e)return{};var a,n,i={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(i[a]=e[a]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}var Me,je,Le,De,Te,Ae,Re,Ie,Fe,Ve,ze,Be=function(e){var t=e.svgRef,a=e.title,n=Pe(e,Se);return i.a.createElement("svg",xe({width:22,height:22,viewBox:"0 0 22 22",fill:"none",ref:t},n),a?i.a.createElement("title",null,a):null,ue||(ue=i.a.createElement("mask",{id:"mask0","mask-type":"alpha",maskUnits:"userSpaceOnUse",x:1,y:4,width:20,height:16},i.a.createElement("path",{d:"M14 18L1.5 19.5V11H11L7.5 4H15L21 7.5L19.5 11H11L14 18Z",fill:"#C4C4C4"}))),he||(he=i.a.createElement("g",{mask:"url(#mask0)"},i.a.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M11.8702 5.17048C12.0558 5.37492 12.0406 5.69113 11.8361 5.87677L11.4559 6.22205C13.2607 6.29197 14.9052 6.77417 16.1414 7.53978C17.4733 8.36474 18.3989 9.56969 18.3989 10.9865C18.3989 12.8147 16.8735 14.28 14.8628 15.0671C14.6056 15.1677 14.3156 15.0409 14.2149 14.7837C14.1142 14.5266 14.2411 14.2365 14.4982 14.1359C16.3555 13.4088 17.3989 12.202 17.3989 10.9865C17.3989 10.0433 16.78 9.1116 15.6148 8.38992C14.5338 7.72039 13.0403 7.27515 11.3592 7.2192L11.8441 7.67923C12.0445 7.86929 12.0528 8.18576 11.8627 8.38609C11.6727 8.58642 11.3562 8.59475 11.1559 8.40469L9.79036 7.10922L9.39955 6.73845L9.79837 6.37632L11.1639 5.13643C11.3683 4.95079 11.6845 4.96604 11.8702 5.17048ZM7.78398 7.18934C7.88464 7.44648 7.75779 7.73653 7.50064 7.83719C5.64334 8.56424 4.59998 9.77104 4.59998 10.9865C4.59998 11.9298 5.21888 12.8615 6.38406 13.5831C7.46436 14.2523 8.95665 14.6974 10.6364 14.7538L10.1653 14.3293C9.96016 14.1444 9.9437 13.8283 10.1285 13.6231C10.3134 13.418 10.6295 13.4015 10.8347 13.5864L12.2393 14.8519L12.6509 15.2228L12.2399 15.5943L10.8353 16.8641C10.6305 17.0493 10.3143 17.0333 10.1291 16.8285C9.94391 16.6236 9.95985 16.3075 10.1647 16.1223L10.5741 15.7522C8.75704 15.6866 7.10072 15.2033 5.85751 14.4333C4.52557 13.6083 3.59998 12.4034 3.59998 10.9865C3.59998 9.15836 5.12539 7.6931 7.13612 6.906C7.39327 6.80534 7.68332 6.93219 7.78398 7.18934Z",fill:"currentColor"}))),de||(de=i.a.createElement("mask",{id:"mask1","mask-type":"alpha",maskUnits:"userSpaceOnUse",x:2,y:6,width:18,height:12},i.a.createElement("path",{d:"M4 7.5L7.5 6L11 11L16 10L20 9L18 15.5L14.5 17.5L13 15.5L11 11L2 13L4 7.5Z",fill:"#C4C4C4"}))),pe||(pe=i.a.createElement("g",{mask:"url(#mask1)"},i.a.createElement("path",{d:"M10.9994 15.2597C7.18897 15.2597 4.09998 13.3465 4.09998 10.9864C4.09998 9.46461 5.38437 8.12857 7.31838 7.3715M10.9994 6.71313C14.8099 6.71313 17.8989 8.62636 17.8989 10.9864C17.8989 12.5083 16.6145 13.8443 14.6805 14.6014",stroke:"currentColor",strokeWidth:1,strokeDasharray:"1.5 1"}))),me||(me=i.a.createElement("circle",{cx:11,cy:11,r:1.5,fill:"currentColor"})),ve||(ve=i.a.createElement("ellipse",{opacity:.1,cx:11,cy:11,rx:7,ry:4.5,fill:"currentColor"})))},Ue=i.a.forwardRef((function(e,t){return i.a.createElement(Be,xe({svgRef:t},e))})),Ne=(a.p,["svgRef","title"]);function He(){return(He=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function We(e,t){if(null==e)return{};var a,n,i=function(e,t){if(null==e)return{};var a,n,i={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(i[a]=e[a]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}var Ge,Ze,Ye,qe=function(e){var t=e.svgRef,a=e.title,n=We(e,Ne);return i.a.createElement("svg",He({width:17,height:12,viewBox:"0 0 17 12",fill:"none",ref:t},n),a?i.a.createElement("title",null,a):null,Me||(Me=i.a.createElement("path",{opacity:.1,d:"M8.5 1V10L2 4L4.5 2L7.5 1H8.5Z",fill:"currentColor"})),je||(je=i.a.createElement("path",{d:"M8.49996 10L7.32239 8.91309",stroke:"currentColor"})),Le||(Le=i.a.createElement("path",{d:"M4.33914 5.47879C4.13623 5.29149 3.8199 5.30414 3.6326 5.50705C3.4453 5.70996 3.45795 6.02629 3.66086 6.21359L4.33914 5.47879ZM3.66086 6.21359L4.03586 6.55975L4.71414 5.82494L4.33914 5.47879L3.66086 6.21359ZM4.78586 7.25205L5.53586 7.94436L6.21414 7.20956L5.46414 6.51725L4.78586 7.25205ZM6.28586 8.63667L7.03586 9.32898L7.71414 8.59417L6.96414 7.90187L6.28586 8.63667ZM7.78586 10.0213L8.16086 10.3674L8.83914 9.63264L8.46414 9.28648L7.78586 10.0213Z",fill:"currentColor"})),De||(De=i.a.createElement("path",{opacity:.1,d:"M8.5 1V10L15 4L12.5 2L9.5 1H8.5Z",fill:"currentColor"})),Te||(Te=i.a.createElement("path",{d:"M12.6609 5.47879C12.8638 5.29149 13.1801 5.30414 13.3674 5.50705C13.5547 5.70996 13.5421 6.02629 13.3391 6.21359L12.6609 5.47879ZM13.3391 6.21359L12.9641 6.55975L12.2859 5.82494L12.6609 5.47879L13.3391 6.21359ZM12.2141 7.25205L11.4641 7.94436L10.7859 7.20956L11.5359 6.51725L12.2141 7.25205ZM10.7141 8.63667L9.96414 9.32898L9.28586 8.59417L10.0359 7.90187L10.7141 8.63667ZM9.21414 10.0213L8.83914 10.3674L8.16086 9.63264L8.53586 9.28648L9.21414 10.0213Z",fill:"currentColor"})),Ae||(Ae=i.a.createElement("path",{d:"M8.50004 10L9.67761 8.91309",stroke:"currentColor"})),Re||(Re=i.a.createElement("ellipse",{cx:8.50009,cy:9.78971,rx:1.40625,ry:1.38785,fill:"currentColor"})),Ie||(Ie=i.a.createElement("path",{d:"M2.53455 2.94698C2.33236 3.13506 2.32091 3.45143 2.50899 3.65363C2.69706 3.85582 3.01344 3.86726 3.21563 3.67919L2.53455 2.94698ZM3.21563 3.67919C4.57018 2.41922 6.52823 1.5 8.5001 1.5V0.5C6.23455 0.5 4.04178 1.54499 2.53455 2.94698L3.21563 3.67919Z",fill:"currentColor"})),Fe||(Fe=i.a.createElement("path",{d:"M1.82086 4.41481L1.31758 4.41471L1.31758 4.95116L1.85954 4.91005L1.82086 4.41481ZM2.32411 2.6635C2.32411 2.38918 2.09878 2.16675 1.82083 2.16669C1.54287 2.16664 1.31755 2.38897 1.31755 2.66329L2.32411 2.6635ZM3.4816 4.787C3.75873 4.76598 3.96607 4.52721 3.94471 4.2537C3.92335 3.98019 3.68137 3.7755 3.40424 3.79653L3.4816 4.787ZM2.19339 4.74886C2.37737 4.54901 3.037 3.85256 3.22786 3.66738L2.52212 2.95891C2.30928 3.16541 1.63313 3.88001 1.44832 4.08076L2.19339 4.74886ZM2.32414 4.41491L2.32411 2.6635L1.31755 2.66329L1.31758 4.41471L2.32414 4.41491ZM1.85954 4.91005L3.4816 4.787L3.40424 3.79653L1.78217 3.91957L1.85954 4.91005Z",fill:"currentColor"})),Ve||(Ve=i.a.createElement("path",{d:"M14.4655 2.94698C14.6677 3.13506 14.6792 3.45143 14.4911 3.65363C14.303 3.85582 13.9867 3.86726 13.7845 3.67919L14.4655 2.94698ZM13.7845 3.67919C12.4299 2.41922 10.4719 1.5 8.49999 1.5V0.5C10.7655 0.5 12.9583 1.54499 14.4655 2.94698L13.7845 3.67919Z",fill:"currentColor"})),ze||(ze=i.a.createElement("path",{d:"M15.1791 4.41476L15.6824 4.41461L15.6825 4.95112L15.1404 4.90999L15.1791 4.41476ZM14.6757 2.66345C14.6757 2.38913 14.901 2.16669 15.179 2.16661C15.4569 2.16653 15.6823 2.38885 15.6823 2.66316L14.6757 2.66345ZM13.5182 4.78692C13.2411 4.76589 13.0338 4.52712 13.0551 4.25361C13.0765 3.9801 13.3185 3.77542 13.5956 3.79644L13.5182 4.78692ZM14.8066 4.74881C14.6226 4.54896 13.963 3.85251 13.7721 3.66733L14.4779 2.95885C14.6907 3.16536 15.3669 3.87995 15.5517 4.08071L14.8066 4.74881ZM14.6759 4.4149L14.6757 2.66345L15.6823 2.66316L15.6824 4.41461L14.6759 4.4149ZM15.1404 4.90999L13.5182 4.78692L13.5956 3.79644L15.2178 3.91952L15.1404 4.90999Z",fill:"currentColor"})))},Xe=i.a.forwardRef((function(e,t){return i.a.createElement(qe,He({svgRef:t},e))})),Qe=(a.p,Object(be.a)((function(e){var t="0px 15px 25px rgba(0, 0, 0, 0.15), 0px 5px 10px rgba(0, 0, 0, 0.05)";return{root:{marginBottom:e.spacing(1.5),marginRight:e.spacing(1.5)},input:{position:"absolute",opacity:0,pointerEvents:"none"},button:{position:"relative",width:e.cameraPreviewWidth,height:e.cameraPreviewHeight,borderRadius:e.shape.borderRadius,backgroundColor:e.palette.common.black,backgroundSize:"contain",backgroundPosition:"center",backgroundRepeat:"no-repeat",boxShadow:t,cursor:"pointer",overflow:"hidden",transition:e.transitions.create(["box-shadow"],{duration:e.transitions.duration.short}),"&:hover:not($buttonChecked)":{boxShadow:t+", 0 0 0 2px ".concat(e.palette.grey[300]," inset")}},buttonChecked:{boxShadow:t+", 0 0 0 2px ".concat(e.palette.primary.main," inset")},icon:{position:"absolute",bottom:e.spacing(1),right:e.spacing(1),display:"flex",alignItems:"center",justifyContent:"center",width:22,height:22,borderRadius:"50%",backgroundColor:e.palette.grey[900]}}}))),$e=function(e){var t=e.appear,a=e.type,r=void 0===a?"Static":a,o=e.autoFocus,s=e.checked,l=e.id,c=e.image,u=e.name,h=e.tabIndex,d=e.value,p=e.onChange,m=Qe(),v=Object(Ee.a)(),f=void 0===s?(null==v?void 0:v.value)===d:s,g=void 0===u?null==v?void 0:v.name:u,b=i.a.createElement("div",{className:Object(ge.a)(m.button,Object(fe.a)({},m.buttonChecked,f)),style:{backgroundImage:"url(".concat(c,")")}},"Static"!==r&&i.a.createElement("div",{className:m.icon},function(){switch(r){case"Orbital":return i.a.createElement(Ue,null);case"FreeLook":return i.a.createElement(Xe,null)}}()));return i.a.createElement("label",{className:m.root},i.a.createElement("input",{autoFocus:o,checked:f,className:m.input,id:l,name:g,onChange:function(e){p&&p(e),(null==v?void 0:v.onChange)&&v.onChange(e,e.target.value)},tabIndex:h,type:"radio",value:d}),t?Object(n.cloneElement)(t,{children:b}):b)},Ke=["svgRef","title"];function Je(){return(Je=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function et(e,t){if(null==e)return{};var a,n,i=function(e,t){if(null==e)return{};var a,n,i={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(i[a]=e[a]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}var tt,at,nt,it,rt,ot,st=function(e){var t=e.svgRef,a=e.title,n=et(e,Ke);return i.a.createElement("svg",Je({width:83,height:84,viewBox:"0 0 83 84",fill:"none",ref:t},n),a?i.a.createElement("title",null,a):null,Ge||(Ge=i.a.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M42 35H21L21 56H34.2949L34.7564 58H21C19.8954 58 19 57.1046 19 56V35C19 33.8954 19.8954 33 21 33H42C43.1046 33 44 33.8954 44 35V48.7562L42 48.2947V35Z",fill:"currentColor"})),Ze||(Ze=i.a.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M44.7627 54.9818L47.4149 52.3296C47.6926 52.0519 47.5564 51.5772 47.1738 51.4889L35.3628 48.7633C35.0027 48.6802 34.6801 49.0028 34.7632 49.3629L37.4888 61.1739C37.5771 61.5565 38.0518 61.6927 38.3295 61.415L41.2271 58.5174L46.7267 64.017C46.922 64.2122 47.2386 64.2122 47.4338 64.017L50.2623 61.1885C50.4575 60.9933 50.4575 60.6767 50.2623 60.4814L44.7627 54.9818Z",fill:"currentColor"})),Ye||(Ye=i.a.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M39 25.8062V24.392L40.392 23H41.8062L39 25.8062ZM39 28.2118L44.2118 23H45.626L39 29.626V28.2118ZM39 32.0316L48.0316 23H49.4459L39.4459 33H39V32.0316ZM44 47.545L64 27.545V26.1308L44 46.1308V47.545ZM44 43.7252L63.9698 23.7553C63.8828 23.4092 63.6153 23.1347 63.2732 23.0378L44 42.3109V43.7252ZM44 39.9053L60.9053 23H59.4911L44 38.4911V39.9053ZM44 36.0855L57.0855 23H55.6713L43.9768 34.6945C43.9921 34.7941 44 34.8961 44 35V36.0855ZM42.9988 33.2669L53.2657 23H51.8515L41.8515 33H42C42.3638 33 42.7049 33.0971 42.9988 33.2669ZM45.9506 48L64 29.9506V31.3648L47.3648 48H45.9506ZM49.7704 48L64 33.7704V35.1846L51.1846 48H49.7704ZM53.5902 48L64 37.5902V39.0045L55.0045 48H53.5902ZM57.4101 48L64 41.4101V42.8243L58.8243 48H57.4101ZM61.2299 48L64 45.2299V46.6441L62.6441 48H61.2299Z",fill:"#3393FA"})))},lt=i.a.forwardRef((function(e,t){return i.a.createElement(st,Je({svgRef:t},e))})),ct=(a.p,["svgRef","title"]);function ut(){return(ut=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function ht(e,t){if(null==e)return{};var a,n,i=function(e,t){if(null==e)return{};var a,n,i={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(i[a]=e[a]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}var dt,pt,mt,vt,ft,gt,bt,yt=function(e){var t=e.svgRef,a=e.title,n=ht(e,ct);return i.a.createElement("svg",ut({width:50,height:42,viewBox:"0 0 50 42",fill:"none",ref:t},n),a?i.a.createElement("title",null,a):null,tt||(tt=i.a.createElement("path",{d:"M37.8141 10.5093V3.79999C37.8141 2.69542 36.9187 1.79999 35.8141 1.79999L17.9796 1.79999C17.4457 1.79999 16.934 2.01345 16.5584 2.39285L8.28937 10.7448C8.10399 10.9321 8 11.1849 8 11.4484V38.2C8 39.3046 8.89543 40.2 10 40.2H35.8141C36.9187 40.2 37.8141 39.3044 37.8141 38.1998C37.8141 37.6734 37.8141 37.1762 37.8141 36.901",stroke:"currentcolor",strokeWidth:2,strokeLinecap:"round"})),at||(at=i.a.createElement("path",{d:"M8 29.0144L12.9646 24L17.9292 29.0144L22.8938 24L27.9083 29.0144L32.9227 24L37.9371 29.0144",stroke:"currentcolor",strokeLinecap:"round"})),nt||(nt=i.a.createElement("path",{d:"M9 12H18V3",stroke:"currentcolor",strokeWidth:2,strokeLinecap:"round"})),it||(it=i.a.createElement("path",{d:"M36.4421 14.1476C36.9938 13.1673 38.3731 13.1673 38.9248 14.1476L48.8556 31.7923C49.4073 32.7726 48.7177 33.9979 47.6143 33.9979H27.7526C26.6492 33.9979 25.9596 32.7726 26.5113 31.7923L36.4421 14.1476Z",fill:"url(#paint0_linear)"})),rt||(rt=i.a.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M38.8141 20.5381C38.8141 19.9858 38.3664 19.5381 37.8141 19.5381C37.2618 19.5381 36.8141 19.9858 36.8141 20.5381V25.0247C36.8141 25.577 37.2618 26.0247 37.8141 26.0247C38.3664 26.0247 38.8141 25.577 38.8141 25.0247V20.5381ZM38.8141 28.9834C38.8141 28.4312 38.3664 27.9834 37.8141 27.9834C37.2618 27.9834 36.8141 28.4312 36.8141 28.9834V29.5113C36.8141 30.0636 37.2618 30.5113 37.8141 30.5113C38.3664 30.5113 38.8141 30.0636 38.8141 29.5113V28.9834Z",fill:"currentcolor"})),ot||(ot=i.a.createElement("defs",null,i.a.createElement("linearGradient",{id:"paint0_linear",x1:37.7406,y1:16.3154,x2:37.7406,y2:31.0948,gradientUnits:"userSpaceOnUse"},i.a.createElement("stop",{stopColor:"#F04C5A"}),i.a.createElement("stop",{offset:1,stopColor:"#EE7B5C"})))))},_t=i.a.forwardRef((function(e,t){return i.a.createElement(yt,ut({svgRef:t},e))})),kt=(a.p,["svgRef","title"]);function Ct(){return(Ct=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function wt(e,t){if(null==e)return{};var a,n,i=function(e,t){if(null==e)return{};var a,n,i={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(i[a]=e[a]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}var Ot,Et,St,xt=function(e){var t=e.svgRef,a=e.title,n=wt(e,kt);return i.a.createElement("svg",Ct({width:56,height:56,viewBox:"0 0 56 56",fill:"none",ref:t},n),a?i.a.createElement("title",null,a):null,dt||(dt=i.a.createElement("path",{d:"M27.7773 42.5814L27.7773 13.5505",stroke:"currentcolor",strokeWidth:2,strokeLinecap:"round"})),pt||(pt=i.a.createElement("path",{d:"M15.974 42.5814L15.974 13.5505",stroke:"currentcolor",strokeWidth:2,strokeLinecap:"round"})),mt||(mt=i.a.createElement("path",{d:"M39.5806 42.5814L39.5806 13.5505",stroke:"currentcolor",strokeWidth:2,strokeLinecap:"round"})),vt||(vt=i.a.createElement("path",{d:"M41.9905 35.1917C41.9905 36.5401 40.9057 37.6227 39.5806 37.6227C38.2555 37.6227 37.1708 36.5401 37.1708 35.1917C37.1708 33.8433 38.2555 32.7608 39.5806 32.7608C40.9057 32.7608 41.9905 33.8433 41.9905 35.1917Z",fill:"#1C1E22",stroke:"currentcolor",strokeWidth:2})),ft||(ft=i.a.createElement("path",{d:"M18.3838 20.9402C18.3838 22.2886 17.2991 23.3711 15.974 23.3711C14.6489 23.3711 13.5641 22.2886 13.5641 20.9402C13.5641 19.5918 14.6489 18.5093 15.974 18.5093C17.2991 18.5093 18.3838 19.5918 18.3838 20.9402Z",fill:"#1C1E22",stroke:"currentcolor",strokeWidth:2})),gt||(gt=i.a.createElement("path",{d:"M30.1872 28.0659C30.1872 29.4143 29.1025 30.4969 27.7773 30.4969C26.4522 30.4969 25.3675 29.4143 25.3675 28.0659C25.3675 26.7176 26.4522 25.635 27.7773 25.635C29.1025 25.635 30.1872 26.7176 30.1872 28.0659Z",fill:"#1C1E22",stroke:"currentcolor",strokeWidth:2})),bt||(bt=i.a.createElement("path",{d:"M54.0561 28.0659C54.0561 42.6783 42.2849 54.5134 27.7773 54.5134C13.2697 54.5134 1.49854 42.6783 1.49854 28.0659C1.49854 13.4536 13.2697 1.61853 27.7773 1.61853C42.2849 1.61853 54.0561 13.4536 54.0561 28.0659Z",stroke:"currentcolor",strokeWidth:2})))},Pt=i.a.forwardRef((function(e,t){return i.a.createElement(xt,Ct({svgRef:t},e))})),Mt=(a.p,Object(be.a)((function(e){return{root:{padding:e.spacing(5),textAlign:"center"},icon:{display:"flex",alignItems:"center",justifyContent:"center",marginLeft:"auto",marginRight:"auto",marginBottom:e.spacing(4),width:88,height:88,borderRadius:"50%",backgroundColor:e.palette.grey[700]}}}))),jt=function(e){var t=e.icon,a=e.children,n=e.overline,r=e.title,o=Mt();return i.a.createElement("div",{className:o.root},t&&i.a.createElement("div",{className:o.icon},function(){switch(t){case"empty":return i.a.createElement(Pt,null);case"error":return i.a.createElement(_t,null);case"dragdrop":return i.a.createElement(lt,null)}}()),n&&i.a.createElement(ke.a,{variant:"overline",color:"textSecondary"},n),i.a.createElement(ke.a,{variant:"h6",gutterBottom:!0},r),i.a.createElement(ke.a,{variant:"body2",color:"textSecondary"},a))},Lt=a(25),Dt=["#F44336","#FF9800","#FFC107","#FFEB3B","#CDDC39","#8BC34A","#4CAF50"],Tt=Object(be.a)((function(e){var t=e.typography,a=t.fontSize,n=t.fontWeightBold,i=e.spacing(.5),r=e.spacing(2),o=e.palette.common.black;return{root:{zIndex:2,position:"absolute",top:r,left:r,height:40+a+3*i,width:250+2*i,padding:i,backgroundColor:o,color:e.palette.getContrastText(o),fontSize:a,lineHeight:1,fontWeight:n,MozBoxSizing:"border-box",boxSizing:"border-box",pointerEvents:"none"},graph:{position:"absolute",left:i,right:i,bottom:i,height:40,backgroundColor:"#282844",MozBoxSizing:"border-box",boxSizing:"border-box"},bar:{position:"absolute",bottom:0,width:1,boxSizing:"border-box"}}})),At=(Ot=function(){function e(){Object(V.a)(this,e),Object(z.a)(this,"fps",Et,this),this.prevTime=performance.now(),this.frames=0,this.req=0,this.start()}return Object(B.a)(e,[{key:"lastFps",get:function(){return this.fps[this.fps.length-1]||0}},{key:"maxFps",get:function(){return Math.min(60,Math.max.apply(Math.max,this.fps))}},{key:"minFps",get:function(){return Math.max(0,Math.min.apply(Math.min,this.fps))}},{key:"avgFps",get:function(){return Math.round(this.fps.reduce((function(e,t){return e+t}),0)/this.fps.length)}},{key:"calc",value:function(e){var t=this.prevTime,a=this.frames+1;if(this.frames=a,e>t+50){var n=Math.round(1e3*a/(e-t));n>60&&(n=60);var i=[].concat(Object(Lt.a)(this.fps),[n]);this.fps=i.length>250?i.slice(1,251):i,this.prevTime=e,this.frames=0}this.start()}},{key:"start",value:function(){this.req=requestAnimationFrame(this.calc.bind(this))}},{key:"stop",value:function(){cancelAnimationFrame(this.req)}}]),e}(),Et=Object(U.a)(Ot.prototype,"fps",[N.observable],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Object(U.a)(Ot.prototype,"lastFps",[N.computed],Object.getOwnPropertyDescriptor(Ot.prototype,"lastFps"),Ot.prototype),Object(U.a)(Ot.prototype,"maxFps",[N.computed],Object.getOwnPropertyDescriptor(Ot.prototype,"maxFps"),Ot.prototype),Object(U.a)(Ot.prototype,"minFps",[N.computed],Object.getOwnPropertyDescriptor(Ot.prototype,"minFps"),Ot.prototype),Object(U.a)(Ot.prototype,"avgFps",[N.computed],Object.getOwnPropertyDescriptor(Ot.prototype,"avgFps"),Ot.prototype),Object(U.a)(Ot.prototype,"calc",[N.action],Object.getOwnPropertyDescriptor(Ot.prototype,"calc"),Ot.prototype),Ot),Rt=Object(p.a)((function(){var e=Tt(),t=Object(n.useState)(),a=Object(u.a)(t,2),r=a[0],o=a[1];if(Object(n.useEffect)((function(){var e=new At;return o(e),function(){e.stop(),o(void 0)}}),[]),!r)return null;var s=r.fps,l=r.lastFps,c=r.avgFps,h=r.minFps,d=r.maxFps;return i.a.createElement("div",{className:e.root},i.a.createElement("span",null,"FPS: ",l," MIN: ",h," AVG: ",c," MAX: ",d),i.a.createElement("div",{className:e.graph},s.map((function(t,a){var n=40*t/60,r=Dt[Math.floor(t/10)],o=s.length-1-a+"px";return i.a.createElement("div",{key:"fps-".concat(a),className:e.bar,style:{backgroundColor:r,height:n,right:o}})}))))})),It=a(129),Ft=Object(be.a)((function(){return{list:{position:"relative",margin:0,padding:0,listStyle:"none"}}})),Vt=function(e){var t=e.children,a=Ft();return i.a.createElement("ul",{className:a.list},t)},zt=Object(be.a)((function(e){var t="1px 0 0 0 ".concat(e.palette.grey[500]," inset");return{item:{display:"flex",alignItems:"center",padding:e.spacing(1.25,0,1.25,2),boxShadow:t,cursor:"pointer",fontSize:14,"&:hover":{boxShadow:"2px 0 0 0 ".concat(e.palette.primary.main," inset, ")+t}},selected:{"&::before":{display:"inline-block",height:6,width:6,marginRight:e.spacing(1),borderRadius:"50%",backgroundColor:e.palette.primary.main,content:"''"}}}})),Bt=function(e){var t=e.children,a=e.appear,r=e.selected,o=e.onClick,s=zt(),l=i.a.createElement("li",{onClick:o,className:Object(ge.a)(s.item,Object(fe.a)({},s.selected,r))},t);return a?Object(n.cloneElement)(a,{children:l}):l},Ut=a(138),Nt=a(139),Ht=a(128),Wt=["svgRef","title"];function Gt(){return(Gt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}function Zt(e,t){if(null==e)return{};var a,n,i=function(e,t){if(null==e)return{};var a,n,i={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(i[a]=e[a]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}var Yt,qt=function(e){var t=e.svgRef,a=e.title,n=Zt(e,Wt);return i.a.createElement("svg",Gt({width:10,height:7,viewBox:"0 0 10 7",fill:"none",ref:t},n),a?i.a.createElement("title",null,a):null,St||(St=i.a.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M3.84717 3.94151L7.57347 0.545648C7.91337 0.23589 8.43269 0.23409 8.77473 0.541484C9.16861 0.895465 9.17075 1.51214 8.77933 1.86885L3.84717 6.36363L0.731052 3.52385C0.339638 3.16715 0.341777 2.55047 0.735655 2.19649C1.07769 1.88909 1.59701 1.89089 1.93691 2.20065L3.84717 3.94151Z",fill:"currentColor"})))},Xt=i.a.forwardRef((function(e,t){return i.a.createElement(qt,Gt({svgRef:t},e))})),Qt=(a.p,Object(be.a)((function(e){var t=e.palette.grey[700],a=e.palette.grey[500],n=ce(e.palette.common.white,a,.2),i=ce(e.palette.primary.main,t,.2),r=ce(e.palette.primary.main,t,.4),o=ce(e.palette.common.white,r,.2),s=e.palette.primary.main,l=e.palette.common.white;return{root:{userSelect:"none","&:not(:last-child)":{marginBottom:e.spacing(1)}},input:{position:"absolute",opacity:0,pointerEvents:"none"},button:{position:"relative",display:"flex",alignItems:"center",padding:e.spacing(1.5),borderRadius:e.shape.borderRadius,backgroundColor:t,color:e.palette.common.white,boxShadow:"0 0 0 1px ".concat(a," inset"),cursor:"pointer",overflow:"hidden",transition:e.transitions.create(["background-color","box-shadow"],{duration:e.transitions.duration.short}),"&:hover":{backgroundColor:i,"&:not($buttonChecked)":{boxShadow:"0 0 0 1px ".concat(r," inset"),"& $checkbox":{borderTopColor:r,color:o}}}},buttonChecked:{boxShadow:"0 0 0 2px ".concat(s," inset")},image:{marginRight:e.spacing(2),height:46,width:46,borderRadius:e.shape.borderRadius,objectFit:"cover"},label:{fontSize:e.typography.pxToRem(14)},checkbox:{position:"absolute",top:0,left:0,width:0,height:0,borderTop:"28px solid ".concat(a),borderRight:"28px solid transparent",color:n,transition:e.transitions.create(["color","border-color"],{duration:e.transitions.duration.short}),content:"''"},checkboxChecked:{color:l,borderTopColor:s},checkboxIcon:{position:"absolute",top:-23,left:5}}}))),$t=function(e){var t=e.appear,a=e.autoFocus,r=e.checked,o=e.id,s=e.image,l=e.label,c=e.name,u=e.tabIndex,h=e.value,d=e.onChange,p=e.onClick,m=Qt(),v=Object(Ee.a)(),f=void 0===r?(null==v?void 0:v.value)===h:r,g=void 0===c?null==v?void 0:v.name:c,b=i.a.createElement("div",{className:Object(ge.a)(m.button,Object(fe.a)({},m.buttonChecked,f))},s&&i.a.createElement("img",{className:m.image,src:s,alt:"Variant"}),i.a.createElement(ke.a,{className:m.label,component:"div"},l),i.a.createElement("div",{className:Object(ge.a)(m.checkbox,Object(fe.a)({},m.checkboxChecked,f))},i.a.createElement(Xt,{className:m.checkboxIcon})));return i.a.createElement("label",{className:m.root},i.a.createElement("input",{autoFocus:a,checked:f,className:m.input,id:o,name:g,onChange:function(e){d&&d(e),(null==v?void 0:v.onChange)&&v.onChange(e,e.target.value)},onClick:function(e){p&&p(e)},tabIndex:u,type:"radio",value:h}),t?Object(n.cloneElement)(t,{children:b}):b)},Kt=Object(be.a)((function(e){return{root:{padding:e.spacing(3),"&:not(:last-child)":{borderBottom:"1px solid ".concat(e.palette.divider)}},label:{marginBottom:e.spacing(1.5),fontSize:e.typography.pxToRem(14),fontWeight:e.typography.fontWeightMedium,textTransform:"uppercase"}}})),Jt=function(e){var t=e.id,a=e.variantIdOffset,r=void 0===a?0:a,o=e.manager,s=Kt(),l=Object(ye.a)(),c=Object(n.useState)(),h=Object(u.a)(c,2),d=h[0],p=h[1],m=Object(n.useState)(),v=Object(u.a)(m,2),f=v[0],g=v[1],b=Object(n.useState)(),y=Object(u.a)(b,2),_=y[0],k=y[1],C=Object(n.useState)(),w=Object(u.a)(C,2),O=w[0],E=w[1],S=Object(n.useState)(),x=Object(u.a)(S,2),P=x[0],M=x[1],j=Object(n.useCallback)(M,[M]),L=Object(n.useCallback)((function(e){o.activate(t,e)}),[o,t]);return Object(n.useEffect)((function(){return p(o.getName(t)),E(o.getVariantIds(t)),g(o.getVariantNames(t)),k(o.getVariantThumbnails(t)),M(o.getState(t)),function(){p(void 0),E(void 0),g(void 0),k(void 0),M(void 0)}}),[o,t]),Object(n.useEffect)((function(){return o.onStateChange(t,j),function(){o.offStateChange(t,j)}}),[o,t,j]),i.a.createElement(Ut.a,{fullWidth:!0,className:s.root},i.a.createElement(Oe,{direction:"left",delay:r*l.listAnimationDelay},i.a.createElement(Nt.a,{component:"legend",className:s.label},d)),i.a.createElement(Ht.a,{"aria-label":"variant-set",id:"variant-set-".concat(t)},O&&O.map((function(e){var t;return i.a.createElement($t,{key:e,appear:i.a.createElement(Oe,{direction:"left",delay:(r+e)*l.listAnimationDelay}),checked:null==P?void 0:P.some((function(t){return t===e})),value:e,label:null!==(t=null==f?void 0:f[e])&&void 0!==t?t:"",image:null==_?void 0:_[e],onClick:function(){return L(e)}})}))))},ea=function(e){var t=e.variantSets,a=e.manager,n=0;return i.a.createElement(i.a.Fragment,null,t.map((function(e){var t=i.a.createElement(Jt,{key:e,id:e,variantIdOffset:n,manager:a});return n+=a.getVariantIds(e).length,t})))},ta=Object(be.a)((function(e){return{root:{display:"flex",flexDirection:"column",height:"100%",overflow:"hidden"},variantSets:{overflowX:"hidden"},levelVariantSets:{flex:"1 1 auto",padding:e.spacing(2,3),overflow:"auto"},meta:{flex:"0 0 auto",padding:e.spacing(3),"& a":{color:e.palette.common.white},"& p:not(:last-of-type)":{marginBottom:e.spacing(2)}}}})),aa=function(e){var t,a=e.gltf,n=e.variantSetManager,r=e.appearDirection,o=e.onLevelVariantSetSelect,s=ta(),l=Object(ye.a)(),c=null!==(t=null==n?void 0:n.levelVariantSets)&&void 0!==t?t:[];return i.a.createElement("div",{className:s.root},n&&1===c.length?i.a.createElement("div",{className:s.variantSets},i.a.createElement(ea,{variantSets:c[0].variantSets,manager:n})):i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:s.levelVariantSets},n&&c.length>0?i.a.createElement(Vt,null,c.map((function(e,t){return i.a.createElement(Bt,{key:t,onClick:function(){return o(t)},appear:i.a.createElement(Oe,{direction:r,delay:"left"===r?t*l.listAnimationDelay:(c.length-1-t)*l.listAnimationDelay})},e.name)}))):i.a.createElement(Oe,{duration:l.transitions.duration.standard},i.a.createElement(jt,{icon:"empty",overline:"Empty",title:"No options"},"This scene does not contain any configurable objects."))),(a.description||a.creator)&&i.a.createElement(Oe,{direction:"up"},i.a.createElement(It.a,null),i.a.createElement("div",{className:s.meta},a.description&&i.a.createElement(i.a.Fragment,null,i.a.createElement(ke.a,{variant:"overline",color:"textSecondary"},"Description"),i.a.createElement(ke.a,{variant:"body2"},a.description)),a.creator&&i.a.createElement(i.a.Fragment,null,i.a.createElement(ke.a,{variant:"overline",color:"textSecondary"},"Creator"),i.a.createElement(ke.a,{variant:"body2"},a.creatorUrl?i.a.createElement("a",{href:a.creatorUrl,target:"_blank",rel:"noopener noreferrer"},a.creator):a.creator))))))},na=a(14),ia=Object(be.a)((function(e){var t={display:"block",position:"absolute",width:18,height:2,backgroundColor:"currentColor",borderRadius:1,transition:e.transitions.create(["transform","opacity"],{duration:e.transitions.duration.shorter})};return{root:{width:18,height:18},wrapper:{position:"relative",width:18,marginTop:2},layer:Object(na.a)(Object(na.a)({},t),{},{top:1,marginTop:-1,"&::before":Object(na.a)(Object(na.a)({},t),{},{top:6,content:"''"}),"&::after":Object(na.a)(Object(na.a)({},t),{},{top:12,content:"''"})}),layerActive:{transform:"translate3d(0, ".concat(6,"px, 0) rotate(45deg)"),"&::before":{transform:"rotate(-45deg) translate3d(".concat(18/-7,"px, ").concat(-4,"px, 0)"),opacity:0},"&::after":{transform:"translate3d(0, ".concat(-12,"px, 0) rotate(-90deg)")}}}})),ra=function(e){var t=e.active,a=ia();return i.a.createElement("div",{className:a.root},i.a.createElement("div",{className:a.wrapper},i.a.createElement("div",{className:Object(ge.a)(a.layer,Object(fe.a)({},a.layerActive,t))})))},oa=(a(103),Object(be.a)((function(e){return{root:{width:42,height:42,transform:"translateX(-50%) translateY(-50%)",padding:e.spacing(.5),borderRadius:"50%",borderWidth:1,borderStyle:"solid",borderColor:e.palette.common.white,backgroundColor:e.palette.common.white,boxShadow:e.shadows[6],opacity:.8,transition:e.transitions.create(["background-color","opacity"],{duration:e.transitions.duration.standard}),"&:hover":{opacity:1}},active:{backgroundColor:e.palette.primary.light,opacity:1},image:{width:"100%",height:"100%",borderWidth:1,borderStyle:"solid",borderColor:e.palette.common.white,borderRadius:"50%",backgroundSize:"cover",transition:e.transitions.create(["background"],{duration:e.transitions.duration.standard})}}})),a(136)),sa=Object(be.a)((function(e){return{drawer:{width:e.sidebarWidth,flexShrink:0},drawerPaper:{position:"relative",width:"100%",border:"none"}}})),la=function(e){var t=e.children,a=e.open,n=sa();return i.a.createElement(oa.a,{className:n.drawer,variant:"persistent",anchor:"right",open:a,onWheel:function(e){return e.nativeEvent.stopPropagation()},onMouseDown:function(e){e.stopPropagation()},classes:{paper:n.drawerPaper},PaperProps:{"data-testid":"sidebar"}},t)},ca=a(130),ua=Object(be.a)((function(e){var t={display:"block",position:"absolute",width:16,height:2,backgroundColor:"currentColor",borderRadius:1,animationFillMode:"forwards",animationTimingFunction:e.transitions.easing.easeOut,animationDuration:"".concat(e.transitions.duration.shorter,"ms")};return{"@keyframes beforeLayerEnter":{from:{transform:"translate3d(0, 0, 0) rotate(0deg)"},to:{transform:"translate3d(".concat(-2,"px, ").concat(10*-.28,"px, 0) rotate(-45deg)")}},"@keyframes afterLayerEnter":{from:{transform:"translate3d(0, 0, 0) rotate(0deg)"},to:{transform:"translate3d(".concat(-2,"px, ").concat(10*.28,"px, 0) rotate(45deg)")}},root:{width:18,height:18},wrapper:{position:"relative",width:18,marginTop:8,marginLeft:2},layer:Object(na.a)(Object(na.a)({},t),{},{top:"50%",marginTop:-1,"&::before":Object(na.a)(Object(na.a)({},t),{},{top:0,width:10,animationName:"$beforeLayerEnter",content:"''"}),"&::after":Object(na.a)(Object(na.a)({},t),{},{bottom:0,width:10,animationName:"$afterLayerEnter",content:"''"})})}})),ha=function(){var e=ua();return i.a.createElement("div",{className:e.root},i.a.createElement("div",{className:e.wrapper},i.a.createElement("div",{className:e.layer})))},da=Object(be.a)((function(e){return{root:{display:"flex",flexDirection:"column",height:"100%",overflow:"hidden"},header:{display:"flex",alignItems:"center",flex:"0 0 ".concat(e.topbarHeight,"px"),paddingLeft:e.spacing(3),paddingRight:e.spacing(3),backgroundColor:e.palette.grey[700]},backButtonWrapper:{display:"flex",alignItems:"center",marginLeft:-e.spacing(3),marginRight:e.spacing(1),paddingLeft:e.spacing(2),height:"100%",backgroundColor:e.palette.grey[700],zIndex:1},backButton:{padding:e.spacing(1)},title:{},body:{flex:"1 1 auto",height:"100%","overflow-x":"hidden","overflow-y":"auto"}}})),pa=function(e){var t=e.children,a=e.title,n=e.appearDirection,r=void 0===n?"left":n,o=e.onNavigateBack,s=da();return i.a.createElement("div",{className:s.root},i.a.createElement("div",{className:s.header},o&&i.a.createElement("div",{className:s.backButtonWrapper},i.a.createElement(ca.a,{className:s.backButton,size:"small",disableTouchRipple:!0,onClick:o},i.a.createElement(ha,null))),i.a.createElement(ke.a,{className:s.title,variant:"button"},i.a.createElement(Oe,{key:a,direction:r},a))),i.a.createElement("div",{className:s.body},t))},ma=Object(be.a)((function(e){return{button:{marginLeft:e.spacing(1),padding:e.spacing(1)}}})),va=function(e){var t=e.open,a=e.toggleOpen,n=ma();return i.a.createElement(ca.a,{className:n.button,"aria-label":"open sidebar","data-testid":"sidebar-toggle",disableTouchRipple:!0,onClick:function(){return a(!t)}},i.a.createElement(ra,{active:t}))},fa=a(12),ga=a.n(fa),ba=a(140),ya=a(131),_a=a(132);!function(e){e.Loop="LOOP",e.LoopReverse="LOOP_REVERSE",e.Once="ONCE",e.OnceReverse="ONCE_REVERSE"}(Yt||(Yt={}));var ka,Ca=function(){function e(t,a,n,i){var r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5?arguments[5]:void 0;Object(V.a)(this,e),this._node=t,this._layer=a,this._index=n,this._defaultState=i,this._autoPlay=r,this._initialStartTime=o,this._layer.pause()}return Object(B.a)(e,[{key:"node",get:function(){return this._node}},{key:"index",get:function(){return this._index}},{key:"name",get:function(){return this._layer.name}},{key:"playable",get:function(){return this._layer.playable}},{key:"defaultState",get:function(){return this._defaultState}},{key:"activeState",get:function(){return this._layer.activeState}},{key:"activeStateClipTime",get:function(){var e=this._layer._controller;if(e.activeStateAnimations.length<1)return 0;var t=e._animEvaluator.findClip(e.activeStateAnimations[0].name);return t?t.time:0}},{key:"init",value:function(){var e=this;this.defaultState&&(this._autoPlay||this._initialStartTime)&&(this.play(this.defaultState,this._initialStartTime),this._autoPlay||requestAnimationFrame((function(){return e.pause()})))}},{key:"play",value:function(e,t){var a=null!=t?t:this._getStartTime(e);this._layer.play(e),this._layer.activeStateCurrentTime=Math.min(a,this._layer.activeStateDuration)}},{key:"pause",value:function(){this._layer.pause()}},{key:"_getStartTime",value:function(e){var t=this;return function(){switch(e){case Yt.Loop:case Yt.Once:return t._layer.activeStateCurrentTime>=t._layer.activeStateDuration?0:t._layer.activeStateCurrentTime;case Yt.LoopReverse:return t._layer.activeStateCurrentTime%t._layer.activeStateDuration;case Yt.OnceReverse:return t._layer.activeStateCurrentTime}}()}}]),e}(),wa=a(1),Oa=a(30),Ea=a(28),Sa=a(46);!function(e){e[e.FreeLook=0]="FreeLook",e[e.Orbital=1]="Orbital"}(ka||(ka={}));var xa=function(e){Object(Oa.a)(a,e);var t=Object(Ea.a)(a);function a(e){var n;return Object(V.a)(this,a),(n=t.call(this,e)).inertiaFactor=.07,n.orbitSensitivity=.3,n.distanceSensitivity=.5,n.dollyDuration=.2,n.nearClipFactor=void 0,n.farClipFactor=void 0,n.allowPan=void 0,n._mode=ka.Orbital,n._cameraComponent=void 0,n._initialized=!1,n._distanceMin=0,n._distanceMax=0,n._pitchAngleMax=90,n._pitchAngleMin=-90,n._yawAngleMax=360,n._yawAngleMin=0,n._distance=0,n._pitch=0,n._yaw=0,n._targetDistance=0,n._targetPitch=0,n._targetYaw=0,n._focusEntity=null,n._focusOffset=new wa.Vec3,n._focusPosition=new wa.Vec3,n._lastFocusDistance=n._distance,n._lastFocusPitch=n._pitch,n._lastFocusYaw=n._yaw,n._lastFocusOffset=new wa.Vec3,n._lookButtonDown=!1,n._panButtonDown=!1,n._lastMousePos=new wa.Vec2,n._lastMouseDelta=new wa.Vec2,n._lastStartDistance=0,n._zoomAnimFrame=0,n._hammer=void 0,n}return Object(B.a)(a,[{key:"mode",get:function(){return this._mode},set:function(e){if(void 0===ka[e])throw new Error("Invalid camera mode '".concat(e,"'"));this._mode!==e&&(this._mode=e,this._setupCameraMode())}},{key:"modeName",get:function(){return ka[this.mode]}},{key:"distanceMax",get:function(){return this._distanceMax},set:function(e){this._distanceMax=e,this._targetDistance=this._clampDistance(this._distance)}},{key:"distanceMin",get:function(){return this._distanceMin},set:function(e){this._distanceMin=e,this._targetDistance=this._clampDistance(this._distance)}},{key:"pitchAngleMax",get:function(){return this._pitchAngleMax},set:function(e){this._pitchAngleMax=e,this._targetPitch=this._clampPitchAngle(this._pitch)}},{key:"pitchAngleMin",get:function(){return this._pitchAngleMin},set:function(e){this._pitchAngleMin=e,this._targetPitch=this._clampPitchAngle(this._pitch)}},{key:"yawAngleMax",get:function(){return this._yawAngleMax},set:function(e){this._yawAngleMax=e,this._targetYaw=this._clampYawAngle(this._yaw)}},{key:"yawAngleMin",get:function(){return this._yawAngleMin},set:function(e){this._yawAngleMin=e,this._targetYaw=this._clampYawAngle(this._yaw)}},{key:"usesYawLimits",get:function(){return this._yawAngleMax-this._yawAngleMin<360}},{key:"distance",get:function(){return this._targetDistance},set:function(e){this._targetDistance=this._clampDistance(e)}},{key:"pitch",get:function(){return this._targetPitch},set:function(e){this._targetPitch=this._clampPitchAngle(e)}},{key:"yaw",get:function(){return this._targetYaw},set:function(e){this._targetYaw=this._clampYawAngle(e)}},{key:"focusEntity",get:function(){return this._focusEntity},set:function(e){var t,a,n;(e=null!==(t=e)&&void 0!==t?t:null)!==this._focusEntity&&(null===(a=this._focusEntity)||void 0===a||a.off("destroy",this._onEntityDestroyed,this),this._focusEntity=e,null===(n=this._focusEntity)||void 0===n||n.on("destroy",this._onEntityDestroyed,this))}},{key:"initialize",value:function(){var e=this,t=this.entity.camera;if(!t)throw new Error("Entity is missing camera component");this._cameraComponent=t,this._setUpMouseEvents(),this._setUpTouchEvents(),this.on("destroy",(function(){e._tearDownMouseEvents(),e._tearDownTouchEvents()})),this._initialized=!0,this._setupCameraMode()}},{key:"postUpdate",value:function(e){var t=0===this.inertiaFactor?1:Math.min(e/this.inertiaFactor,1);this._distance=wa.math.lerp(this._distance,this._targetDistance,t),this._yaw=wa.math.lerp(this._yaw,this._targetYaw,t),this._pitch=wa.math.lerp(this._pitch,this._targetPitch,t),this.mode===ka.Orbital&&this._updateFocusPosition(),this._updatePosition()}},{key:"setYawUsingShortestRoute",value:function(e){var t=(e-this._yaw)%360;this.yaw=t>180?this._yaw-(360-t):t<-180?this._yaw+(360+t):this._yaw+t}},{key:"focus",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.mode===ka.Orbital){var a=t.frameModels,n=t.lookAtEntity,i=t.offset;e||(e=this.app.root),this.focusEntity=e,this._focusOffset.copy(null!=i?i:wa.Vec3.ZERO);var r=a?this._buildAabb(e,["ignoreBoundingBox"]):null;if(r&&this._focusOffset.add(r.center).sub(e.getPosition()),this._updateFocusPosition(),this.distance=r?this._calcDistanceForBoundingBox(r):this.entity.getPosition().distance(this._focusPosition),n){this.entity.lookAt(this._focusPosition,wa.Vec3.UP);var o=this.entity.getRotation();this.yaw=this._calcYaw(o),this.pitch=this._calcPitch(o,this.yaw)}if(this.nearClipFactor&&(this._cameraComponent.nearClip=this.distance*this.nearClipFactor),this.farClipFactor){var s=this._buildAabb(e),l=s?this._calcDistanceForBoundingBox(s):this.distance;this._cameraComponent.farClip=l*this.farClipFactor}this._lastFocusDistance=this.distance,this._lastFocusPitch=this.pitch,this._lastFocusYaw=this.yaw,this._lastFocusOffset.copy(this._focusOffset),this._removeInertia(),this._updatePosition()}else console.warn("focus() can only be used when the Orbital mode is active")}},{key:"resetAndLookAtPoint",value:function(e,t){this.mode===ka.Orbital?(this.entity.setPosition(e),this.focus(null,{lookAtEntity:!0,offset:t})):console.warn("resetAndLookAtPoint() can only be used when the Orbital mode is active")}},{key:"resetAndLookAtEntity",value:function(e,t){this.mode===ka.Orbital?(this.entity.setPosition(e),this.focus(t,{frameModels:!0,lookAtEntity:!0})):console.warn("resetAndLookAtEntity() can only be used when the Orbital mode is active")}},{key:"reset",value:function(e,t,a){void 0!==e&&(this.yaw=e),void 0!==t&&(this.pitch=t),void 0!==a&&(this.distance=a),this._removeInertia()}},{key:"_onEntityDestroyed",value:function(e){this._focusEntity===e&&(this._focusEntity=null)}},{key:"_calcDistanceForBoundingBox",value:function(e){var t=e.halfExtents,a=this._cameraComponent.fov,n=Math.max(t.x,Math.max(t.y,t.z));return n/=Math.tan(.5*a*wa.math.DEG_TO_RAD),n*=2}},{key:"_updatePosition",value:function(){if(this.mode===ka.FreeLook)this.entity.setEulerAngles(this._pitch,this._yaw,0);else if(this.mode===ka.Orbital){this.entity.setLocalPosition(0,0,0),this.entity.setEulerAngles(this._pitch,this._yaw,0);var e=this.entity.getPosition();e.copy(this.entity.forward),e.scale(-this._distance),e.add(this._focusPosition),this.entity.setPosition(e)}}},{key:"_updateFocusPosition",value:function(){this._focusEntity&&this._focusPosition.copy(this._focusEntity.getPosition()).add(this._focusOffset)}},{key:"_removeInertia",value:function(){this._yaw=this._targetYaw,this._pitch=this._targetPitch,this._distance=this._targetDistance}},{key:"_buildAabb",value:function(e,t){var a,n=null;if(t&&(a=e.tags).has.apply(a,Object(Lt.a)(t)))return n;if(e.model)for(var i=e.model.meshInstances,r=0;r<i.length;r+=1)n?n.add(i[r].aabb):n=i[r].aabb.clone();for(var o=0;o<e.children.length;o+=1){var s=this._buildAabb(e.children[o],t);s&&(n?n.add(s):n=s.clone())}return n}},{key:"_calcYaw",value:function(e){var t=new wa.Vec3;return e.transformVector(wa.Vec3.FORWARD,t),Math.atan2(-t.x,-t.z)*wa.math.RAD_TO_DEG}},{key:"_clampDistance",value:function(e){return this.distanceMax>0?wa.math.clamp(e,this.distanceMin,this.distanceMax):Math.max(e,this.distanceMin)}},{key:"_clampPitchAngle",value:function(e){return wa.math.clamp(e,this.pitchAngleMin,this.pitchAngleMax)}},{key:"_clampYawAngle",value:function(e){return this.usesYawLimits?wa.math.clamp(e,this.yawAngleMin,this.yawAngleMax):e}},{key:"_calcPitch",value:function(e,t){var a=new wa.Quat,n=new wa.Quat;n.setFromEulerAngles(0,-t,0),a.mul2(n,e);var i=new wa.Vec3;return a.transformVector(wa.Vec3.FORWARD,i),Math.atan2(i.y,-i.z)*wa.math.RAD_TO_DEG}},{key:"_dolly",value:function(e){var t=this;if(this._zoomAnimFrame&&(cancelAnimationFrame(this._zoomAnimFrame),this._zoomAnimFrame=0),this.mode===ka.Orbital){var a=this.distance,n=this.distanceSensitivity*(.1*this.distance),i=Date.now(),r=1e3*this.dollyDuration;this._zoomAnimFrame=requestAnimationFrame((function o(){var s,l=Date.now()-i,c=.01*(s=l,(n>a?n-a:a-n)*(s/=r)*s+a);t.distance-=e*c,l>=r||(t._zoomAnimFrame=requestAnimationFrame(o))}))}}},{key:"_orbit",value:function(e,t){this.pitch-=t*this.orbitSensitivity,this.yaw-=e*this.orbitSensitivity}},{key:"_pan",value:function(e,t){if(this.mode===ka.Orbital){var a=new wa.Vec3,n=new wa.Vec3,i=new wa.Vec3,r=this.distance;this._cameraComponent.screenToWorld(e,t,r,a),this._cameraComponent.screenToWorld(this._lastMousePos.x,this._lastMousePos.y,r,n),i.sub2(n,a),this._focusOffset.add(i)}}},{key:"_setupCameraMode",value:function(){if(this._initialized)if(this.mode===ka.FreeLook){var e=this.entity.getRotation();this.yaw=this._calcYaw(e),this.pitch=this._calcPitch(e,this.yaw),this._lastFocusDistance=this.distance,this._lastFocusPitch=this.pitch,this._lastFocusYaw=this.yaw,this._lastFocusOffset.copy(wa.Vec3.ZERO),this._removeInertia(),this._updatePosition()}else this.mode===ka.Orbital&&this.focus(this._focusEntity,{lookAtEntity:!0})}},{key:"_onKeyDown",value:function(e){!e.event.prevent&&this.enabled&&(e.key!==wa.KEY_SPACE||!this._focusEntity&&this.mode!==ka.FreeLook||(this._focusOffset.copy(this._lastFocusOffset),this.reset(this._lastFocusYaw,this._lastFocusPitch,this._lastFocusDistance)))}},{key:"_onMouseOut",value:function(){this.enabled&&(this._lookButtonDown=!1,this._panButtonDown=!1)}},{key:"_onMouseDown",value:function(e){if(!e.event.prevent&&this.enabled)switch(e.button){case wa.MOUSEBUTTON_LEFT:this._lookButtonDown=!0;break;case wa.MOUSEBUTTON_RIGHT:case wa.MOUSEBUTTON_MIDDLE:this._panButtonDown=!0,e.event.preventDefault()}}},{key:"_onMouseUp",value:function(e){if(this.enabled)switch(e.button){case wa.MOUSEBUTTON_LEFT:this._lookButtonDown=!1;break;case wa.MOUSEBUTTON_MIDDLE:case wa.MOUSEBUTTON_RIGHT:this._panButtonDown=!1}}},{key:"_onMouseMove",value:function(e){this.enabled&&(this._lookButtonDown?this._orbit(e.dx,e.dy):this._panButtonDown&&this.allowPan&&this._pan(e.x,e.y),this._lastMousePos.set(e.x,e.y))}},{key:"_onMouseWheel",value:function(e){!e.event.prevent&&this.enabled&&(this._dolly(e.wheel),e.event.preventDefault())}},{key:"_setUpMouseEvents",value:function(){this.app.mouse.disableContextMenu(),this.app.keyboard.on(wa.EVENT_KEYDOWN,this._onKeyDown,this),this.app.mouse.on(wa.EVENT_MOUSEDOWN,this._onMouseDown,this),this.app.mouse.on(wa.EVENT_MOUSEUP,this._onMouseUp,this),this.app.mouse.on(wa.EVENT_MOUSEMOVE,this._onMouseMove,this),this.app.mouse.on(wa.EVENT_MOUSEWHEEL,this._onMouseWheel,this),window.addEventListener("mouseout",this._onMouseOut,!1)}},{key:"_tearDownMouseEvents",value:function(){this.app.mouse.off(wa.EVENT_MOUSEDOWN,this._onMouseDown,this),this.app.mouse.off(wa.EVENT_MOUSEUP,this._onMouseUp,this),this.app.mouse.off(wa.EVENT_MOUSEMOVE,this._onMouseMove,this),this.app.mouse.off(wa.EVENT_MOUSEWHEEL,this._onMouseWheel,this),window.removeEventListener("mouseout",this._onMouseOut,!1)}},{key:"_onTouchPinchStart",value:function(e){this.enabled&&(this._lastStartDistance=this.distance,e.preventDefault())}},{key:"_onTouchPinch",value:function(e){this.enabled&&this.mode===ka.Orbital&&(this.distance=this._lastStartDistance/e.scale)}},{key:"_onTouchPanStart",value:function(e){if(this.enabled){var t=e.center,a=t.x,n=t.y,i=e.deltaX,r=e.deltaY;this._lastMousePos.set(a,n),this._lastMouseDelta.set(i,r),this._lookButtonDown=1===e.pointers.length,this._panButtonDown=e.pointers.length>1}}},{key:"_onTouchPanEnd",value:function(){this.enabled&&(this._lookButtonDown=!1,this._panButtonDown=!1)}},{key:"_onTouchPan",value:function(e){if(this.enabled){var t=e.center,a=t.x,n=t.y,i=e.deltaX,r=e.deltaY;if(this._lookButtonDown){var o=i-this._lastMouseDelta.x,s=r-this._lastMouseDelta.y;this._orbit(o,s)}else this._panButtonDown&&this.allowPan&&this._pan(a,n);this._lastMouseDelta.set(i,r),this._lastMousePos.set(a,n)}}},{key:"_setUpTouchEvents",value:function(){var e=new Sa.Pinch,t=new Sa.Pan({direction:Sa.DIRECTION_ALL,pointers:0});t.recognizeWith(e),this._hammer=new Sa.Manager(this.app.graphicsDevice.canvas,{inputClass:Sa.TouchInput}),this._hammer.add([t,e]),this._hammer.on("pinchstart",this._onTouchPinchStart.bind(this)),this._hammer.on("pinch",this._onTouchPinch.bind(this)),this._hammer.on("panstart",this._onTouchPanStart.bind(this)),this._hammer.on("panend",this._onTouchPanEnd.bind(this)),this._hammer.on("pan",this._onTouchPan.bind(this))}},{key:"_tearDownTouchEvents",value:function(){this._hammer&&(this._hammer.destroy(),this._hammer=void 0)}}]),a}(wa.ScriptType),Pa=function(e){Object(Oa.a)(a,e);var t=Object(Ea.a)(a);function a(){var e;Object(V.a)(this,a);for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i)))._material=new wa.Material,e._worldProjectionCenter=new wa.Vec3,e._mapRotationMatrix=new wa.Mat4,e}return Object(B.a)(a,[{key:"initialize",value:function(){this.entity.tags.add("ignoreBoundingBox"),this.entity.addComponent("model"),this._initializeMaterial(),this._updateModel(),this._updateCubemapUniform(),this._updateIntensityUniform(),this._updateMapRotationUniform(),this._updateLightingDistanceUniform(),this._updateTransformRelatedUniforms(),this.on("attr:cubemap",this._updateCubemapUniform,this),this.on("attr:model",this._updateModel,this),this.on("attr:size",this._updateLightingDistanceUniform,this),this.on("attr:size",this._updateEntityScale,this),this.on("attr:angle",this._updateMapRotationUniform,this),this.on("attr:intensity",this._updateIntensityUniform,this),this.on("attr:lightingDistanceFactor",this._updateLightingDistanceUniform,this)}},{key:"postUpdate",value:function(){this._restrictCurrentRotationToY(),this._updateTransformRelatedUniforms()}},{key:"_updateModel",value:function(){var e=this,t=this.model,a=this.entity.model;t?(a.model=t.resource.clone(),a.meshInstances.forEach((function(t){return t.material=e._material}))):a.model=null,this._updateEntityScale()}},{key:"_updateCubemapUniform",value:function(){var e,t=this._material,a=null===(e=this.cubemap)||void 0===e?void 0:e.resource;a?t.setParameter("uHdriMap",a):t.deleteParameter("uHdriMap")}},{key:"_updateLightingDistanceUniform",value:function(){var e=this._material,t=this.size*this.lightingDistanceFactor;e.setParameter("uLightingDistance",t)}},{key:"_updateIntensityUniform",value:function(){var e=this._material,t=this.intensity;e.setParameter("uIntensity",t)}},{key:"_updateTransformRelatedUniforms",value:function(){var e=this._material,t=this._calculateProjectionCenterUniform();e.setParameter("uProjectionCenter",t)}},{key:"_updateMapRotationUniform",value:function(){var e=this._material,t=this._mapRotationMatrix;t.setFromAxisAngle(wa.Vec3.UP.clone(),-this.angle);var a=t.data;e.setParameter("uMapRotationMatrix",a)}},{key:"_updateEntityScale",value:function(){var e,t=this._calculateModelSphereRadius(null===(e=this.model)||void 0===e?void 0:e.resource);if(t>0){var a=this.size/(2*t);this.entity.setLocalScale(a,a,a)}else this.entity.setLocalScale(1,1,1)}},{key:"_restrictCurrentRotationToY",value:function(){var e=this.entity.getRotation(),t=e.getAxisAngle(wa.Vec3.UP.clone());e.setFromAxisAngle(wa.Vec3.UP.clone(),t)}},{key:"_calculateProjectionCenterUniform",value:function(){var e=this.app,t=this._worldProjectionCenter;if(this.useCameraProjection){var a=e.systems.camera.cameras,n=a[a.length-1];if(!n)throw new Error("No active camera found");t.copy(n.entity.getPosition())}else{this.entity.getRotation().transformVector(this.projectionCenter,t),t.add(this.entity.getPosition())}return[t.x,t.y,t.z]}},{key:"_initializeMaterial",value:function(){var e=this.app.graphicsDevice,t=e.precision,a=this._getVertexShaderCode(),n=this._getFragmentShaderCode(),i=new wa.Shader(e,{attributes:{aPosition:wa.SEMANTIC_POSITION,aUv0:wa.SEMANTIC_TEXCOORD0},vshader:a,fshader:"precision ".concat(t," float;\n ").concat(n)});this._material.shader=i}},{key:"_calculateModelSphereRadius",value:function(e){var t=null==e?void 0:e.meshInstances;if(!t||t.length<1)return 0;var a=new wa.BoundingBox;a.copy(t[0].aabb),t.slice(1).forEach((function(e){return a.add(e.aabb)}));var n=[],i=new wa.Vec3,r=new wa.Vec3,o=0;return t.forEach((function(e){for(var t=e.mesh.getPositions(n),s=0;s<t;s+=3)i.set(n[3*s+0],n[3*s+1],n[3*s+2]),r.sub2(i,a.center),o=Math.max(o,r.lengthSq())})),Math.sqrt(o)}},{key:"_getVertexShaderCode",value:function(){return"\n      attribute vec4 aPosition;\n\n      uniform mat4 matrix_model;\n      uniform mat4 matrix_viewProjection;\n\n      varying vec3 vWorldVertexPosition;\n\n      void main(void)\n      {\n        vec4 worldVertexPosition = matrix_model * aPosition;\n        vWorldVertexPosition = worldVertexPosition.xyz;\n        gl_Position = matrix_viewProjection * worldVertexPosition;\n      }\n    "}},{key:"_getFragmentShaderCode",value:function(){var e=this.app.scene,t=wa.shaderChunks,a=wa.programlib,n="";return n+=a.gammaCode(e.gammaCorrection),n+=a.tonemapCode(e.toneMapping),n+=t.rgbmPS,n+="\n      uniform samplerCube uHdriMap;\n      uniform mat4        uMapRotationMatrix;\n      uniform float       uIntensity;\n      uniform vec3        uProjectionCenter;\n      uniform float       uLightingDistance;\n      uniform vec3        view_position;\n\n      varying vec3 vWorldVertexPosition;\n\n      struct HdriAttributes\n      {\n        vec3 baseColor;\n        float specular;\n        vec3 emissiveColor;\n      };\n\n      float saturate(float source)\n      {\n        return clamp(source, 0.0, 1.0);\n      }\n\n      HdriAttributes createHdriAttributes(vec3 in_)\n      {\n        vec3 projectionDirection = normalize(vWorldVertexPosition - uProjectionCenter);\n        vec3 sampleDirection =  (vec4(projectionDirection, 1.0) * uMapRotationMatrix).xyz;\n\n        sampleDirection.x *= -1.0;  // Same flip in x is used by skybox.vert in the Playcanvas engine\n\n        vec3 hdriMapRgb = textureCubeRGBM(uHdriMap, sampleDirection).xyz;\n        vec3 poweredIn = pow(in_, vec3(4.0));\n\n        HdriAttributes result;\n\n        result.baseColor = hdriMapRgb * poweredIn * saturate(uIntensity);\n        result.specular = 0.0;\n        result.emissiveColor = hdriMapRgb * uIntensity * (vec3(1.0) - poweredIn);\n\n        return result;\n      }\n\n      void main(void)\n      {\n        vec3 in_ = vec3(saturate((uLightingDistance - length(vWorldVertexPosition - view_position)) / uLightingDistance));\n\n        HdriAttributes hdriAttributes = createHdriAttributes(in_);\n\n        vec3 color = hdriAttributes.baseColor + vec3(hdriAttributes.specular) + hdriAttributes.emissiveColor;\n\n        color = toneMap(color);\n        color = gammaCorrectOutput(color);\n\n        gl_FragColor = vec4(color, 1.0);\n      }\n    "}}]),a}(wa.ScriptType);Pa.attributes.add("cubemap",{type:"asset",assetType:"cubemap",title:"Cubemap",description:"Assign an imported HDR cubemap that will be projected on the ground & backdrop."}),Pa.attributes.add("model",{type:"asset",assetType:"model",title:"Model",description:"Specify a model to use as a backdrop."}),Pa.attributes.add("size",{type:"number",default:150,title:"Size",description:"The size of the model used to project the HDR cubemap (Meters). The supplied model will be scaled to match the size as closely as possible."}),Pa.attributes.add("angle",{type:"number",default:0,title:"Angle",description:"Absolute clockwise rotation (yaw) of the projected HDR cubemap in degrees. Note that the rotation is independent of the entity's rotation."}),Pa.attributes.add("intensity",{type:"number",default:1,title:"Intensity",description:"Emissivity of the backdrop. Higher values will results brighter ambient lighting sampled from the HDR cubemap (cd/m2)."}),Pa.attributes.add("projectionCenter",{type:"vec3",default:[0,1.7,0],title:"Projection Center",description:"Defines the projection point of the HDR cubemap. Note that the position is relative to the position of the entity this script belongs to."}),Pa.attributes.add("lightingDistanceFactor",{type:"number",default:.5,title:"Lighting Distance Factor",description:"Specify the ground area that will be affected by lighting and shadows. Lit area will have slightly different shading depending on the Intensity and other lighting parameters in the scene."}),Pa.attributes.add("useCameraProjection",{type:"boolean",default:!1,title:"Use Camera Projection",description:"Disables ground tracking, making the HDR cubemap follow the camera."});var Ma=function(e){Object(Oa.a)(a,e);var t=Object(Ea.a)(a);function a(){return Object(V.a)(this,a),t.apply(this,arguments)}return Object(B.a)(a,[{key:"initialize",value:function(){if(!this.entity.model)throw new Error("The entity must have a model-component!");this.applyLightmapToModel()}},{key:"applyLightmapToModel",value:function(){var e=this;this.entity.model.model&&this.entity.model.meshInstances.forEach((function(t){t.material=a._findOrCreateExtendedMaterial(e,t.material),t.setParameter("lm_coordinateScaleBias",e.coordinateScaleBias),t.setParameter("lm_lightmapAdd",e.lightmapAdd),t.setParameter("lm_lightmapScale",e.lightmapScale)}))}},{key:"removeLightmapFromModel",value:function(){this.entity.model.model&&this.entity.model.meshInstances.forEach((function(e){var t=a._findOriginalMaterial(e.material);null!==t&&(e.material=t),e.deleteParameter("lm_coordinateScaleBias"),e.deleteParameter("lm_lightmapAdd"),e.deleteParameter("lm_lightmapScale")}))}}],[{key:"clearCachedMaterialMappings",value:function(){this._materialMappings=[]}},{key:"_findOrCreateExtendedMaterial",value:function(e,t){var a=this._findExtendedMaterial(e,t);if(!a){var n=e.texture,i=e.texCoord;(a=t.clone()).lightMap=n.resource,a.lightMapUv=i,a.chunks.lightmapSinglePS=this._createLightmapSinglePS(),a.update(),this._materialMappings.push({original:t,extended:a})}return a}},{key:"_findExtendedMaterial",value:function(e,t){var a,n;return null!==(a=null===(n=this._materialMappings.find((function(a){return a.extended===t||a.original===t&&a.extended.lightMap===e.texture.resource&&a.extended.lightMapUv===e.texCoord})))||void 0===n?void 0:n.extended)&&void 0!==a?a:null}},{key:"_findOriginalMaterial",value:function(e){var t,a;return null!==(t=null===(a=this._materialMappings.find((function(t){return t.extended===e})))||void 0===a?void 0:a.original)&&void 0!==t?t:null}},{key:"_createLightmapSinglePS",value:function(){return this._getCommonShaderCode()+this._getHighQualityShaderCode()}},{key:"_getCommonShaderCode",value:function(){return"\n      #ifdef MAPTEXTURE\n      uniform sampler2D texture_lightMap;\n      #endif\n\n      uniform vec4 lm_coordinateScaleBias;\n      uniform vec4 lm_lightmapAdd;\n      uniform vec4 lm_lightmapScale;\n\n      vec2 getLightmapUV0(vec2 uv)\n      {\n        return (uv * lm_coordinateScaleBias.xy + lm_coordinateScaleBias.zw) * vec2(1.0, 0.5);\n      }\n\n      vec2 getLightmapUV1(vec2 uv)\n      {\n        return getLightmapUV0(uv) + vec2(0.0, 0.5);\n      }\n    "}},{key:"_getHighQualityShaderCode",value:function(){return"\n      vec2 flipY(vec2 uv)\n      {\n        return vec2(uv.x, 1.0 - uv.y);\n      }\n\n      vec3 getLightMapColorHQ()\n      {\n        // NOTE: Mesh Uv's are flipped in Y(V) compared to UE4, and\n        // we therefore need to temporarily flip them (again) while\n        // performing scale- and bias-calculations.\n        vec2 flippedUv = flipY($UV);\n        vec2 lightmapUv0 = flipY(getLightmapUV0(flippedUv));\n        vec2 lightmapUv1 = flipY(getLightmapUV1(flippedUv));\n\n        vec4 lightmap0 = texture2D(texture_lightMap, lightmapUv0).rgba;\n        vec4 lightmap1 = texture2D(texture_lightMap, lightmapUv1).rgba;\n\n        float logL = lightmap0.w;\n\n        // Add residual\n        logL += lightmap1.w * (1.0 / 255.0) - (0.5 / 255.0);\n\n        // Range scale logL\n        logL = logL * lm_lightmapScale.w + lm_lightmapAdd.w;\n\n        // Range scale uvw\n        vec3 uvw = lightmap0.rgb * lightmap0.rgb * lm_lightmapScale.rgb + lm_lightmapAdd.rgb;\n\n        // logL -> L\n        const float logBlackPoint = 0.01858136;\n        float l = exp2( logL ) - logBlackPoint;\n\n        float directionality = 0.6;\n\n        float luma = l * directionality;\n        vec3 color = luma * uvw;\n\n        return color;\n      }\n\n      void addLightMap() {\n        dDiffuseLight += getLightMapColorHQ();\n      }\n    "}}]),a}(wa.ScriptType);Ma._materialMappings=[],Ma.attributes.add("texture",{type:"asset",assetType:"texture",title:"Texture"}),Ma.attributes.add("texCoord",{type:"number",title:"TexCoord"}),Ma.attributes.add("lightmapAdd",{type:"number",array:!0,title:"Lightmap add coefficients"}),Ma.attributes.add("lightmapScale",{type:"number",array:!0,title:"Lightmap scale coefficients"}),Ma.attributes.add("coordinateScaleBias",{type:"number",array:!0,title:"Coordinate scale & bias"});var ja=a(45),La=["default","hovered","toggled","toggled-hovered"],Da=function(e){Object(Oa.a)(a,e);var t=Object(Ea.a)(a);function a(e){var n;Object(V.a)(this,a),(n=t.call(this,e))._onToggleCallbacks=[],n._active=!1,n._parentElem=null,n._hotspotElem=void 0,n._hotspotImageElems=void 0,n._cachedEntityPosition=void 0,n._pickerEntity=void 0,n._screenPosition=new wa.Vec3,n._lastScreenPosition=new wa.Vec3,n._wasVisible=void 0,n._onClick=n._onClick.bind(Object(ja.a)(n)),n._onMouseOver=n._onMouseOver.bind(Object(ja.a)(n)),n._onMouseOut=n._onMouseOut.bind(Object(ja.a)(n)),n._hotspotElem=document.createElement("div"),n._hotspotImageElems={default:document.createElement("img"),hovered:document.createElement("img"),toggled:document.createElement("img"),"toggled-hovered":document.createElement("img")},Object.values(n._hotspotImageElems).forEach((function(e){return n._hotspotElem.appendChild(e)}));var i=n._hotspotElem.style;return i.position="absolute",i.top="0px",i.left="0px",i.transitionProperty="opacity",i.transitionTimingFunction="cubic-bezier(0.4, 0, 0.2, 1)",Object.values(n._hotspotImageElems).forEach((function(e){e.draggable=!1;var t=e.style;t.position="absolute",t.top="0",t.left="0",t.transform="translateX(-50%) translateY(-50%)",t.opacity="0",t.cursor="pointer"})),n}return Object(B.a)(a,[{key:"active",get:function(){return this._active}},{key:"elem",get:function(){return this._hotspotElem}},{key:"initialize",value:function(){var e=this;a._onInstanceAdded(this),this._setStateImages(),this._setStateVisibility("default"),this._setCachedEntityPosition(),this._setParentElem(),this._setTransitionDuration(),this._addPickerEntity(),this.on("attr:cacheEntityPosition",this._setCachedEntityPosition,this),this.on("attr:parentElementId",this._setParentElem,this),this.on("attr:transitionDuration",this._setTransitionDuration,this),this._hotspotElem.addEventListener("click",this._onClick),this._hotspotElem.addEventListener("mouseover",this._onMouseOver),this._hotspotElem.addEventListener("mouseout",this._onMouseOut),this.on("destroy",(function(){var t;a._onInstanceRemoved(e),null===(t=e._parentElem)||void 0===t||t.removeChild(e._hotspotElem),e._hotspotElem.removeEventListener("click",e._onClick),e._hotspotElem.removeEventListener("mouseover",e._onMouseOver),e._hotspotElem.removeEventListener("mouseout",e._onMouseOut)})),this.app.on("prerender",this._onPrerender,this)}},{key:"onToggle",value:function(e){this._onToggleCallbacks.indexOf(e)>-1||this._onToggleCallbacks.push(e)}},{key:"offToggle",value:function(e){var t=this._onToggleCallbacks.indexOf(e);-1!==t&&this._onToggleCallbacks.splice(t,1)}},{key:"_addPickerEntity",value:function(){this._pickerEntity=new wa.Entity,this._pickerEntity.addComponent("model").model=a._pickerModel.clone(),this.entity.addChild(this._pickerEntity)}},{key:"_onPrerender",value:function(){var e=a._getActiveCamera();if(e){var t=this._screenPosition,n=this._lastScreenPosition;if(n.copy(t),e.worldToScreen(this._getEntityPosition(),t),!n.equals(t)){var i=Math.max(Math.floor((e.farClip-t.z)/e.farClip*1e4),1);this._hotspotElem.style.transform="translateX(".concat(t.x,"px) translateY(").concat(t.y,"px)"),this._hotspotElem.style.zIndex=String(i)}var r=a._isHotspotVisible(this);this._wasVisible!==r&&(this._hotspotElem.style.opacity=r?"1":"0",this._hotspotElem.style.pointerEvents=r?"auto":"none"),this._wasVisible=r}}},{key:"_onClick",value:function(){var e=this;this._active=!this._active,this._onToggleCallbacks.forEach((function(t){return t(e._active)})),this._setStateVisibility(this._active?"toggled-hovered":"hovered")}},{key:"_onMouseOver",value:function(){this._setStateVisibility(this._active?"toggled-hovered":"hovered")}},{key:"_onMouseOut",value:function(){this._setStateVisibility(this._active?"toggled":"default")}},{key:"_setCachedEntityPosition",value:function(){this._cachedEntityPosition=this.cacheEntityPosition?this.entity.getPosition().clone():void 0}},{key:"_getEntityPosition",value:function(){var e;return null!==(e=this._cachedEntityPosition)&&void 0!==e?e:this.entity.getPosition()}},{key:"_setParentElem",value:function(){var e,t=this.parentElementId?document.getElementById(this.parentElementId):this.app.graphicsDevice.canvas.parentElement;t!==this._parentElem&&(null===(e=this._parentElem)||void 0===e||e.removeChild(this._hotspotElem),null==t||t.appendChild(this._hotspotElem));this._parentElem=t}},{key:"_setTransitionDuration",value:function(){this._hotspotElem.style.transitionDuration="".concat(this.transitionDuration,"ms")}},{key:"_getStateImageSource",value:function(e){var t=this;return function(){var a,n,i,r,o;switch(e){case"default":return t.image;case"hovered":return null!==(a=t.hoveredImage)&&void 0!==a?a:t.image;case"toggled":return null!==(n=t.toggledImage)&&void 0!==n?n:t.image;case"toggled-hovered":return null!==(i=null!==(r=null!==(o=t.toggledHoveredImage)&&void 0!==o?o:t.toggledImage)&&void 0!==r?r:t.hoveredImage)&&void 0!==i?i:t.image}}().resource.getSource().src}},{key:"_setStateImages",value:function(){var e=this;La.forEach((function(t){return e._hotspotImageElems[t].src=e._getStateImageSource(t)}))}},{key:"_setStateVisibility",value:function(e){Object.values(this._hotspotImageElems).forEach((function(e){return e.style.opacity="0"})),this._hotspotImageElems[e].style.opacity="1"}}],[{key:"_onInstanceAdded",value:function(e){this._initialize(),this._hotspots.find((function(t){return t.script===e}))||(this._hotspots.push({script:e,pickerPosition:wa.Vec3.ZERO.clone()}),1===this._hotspots.length&&(this._updatePicker(),this._picker.app.on("postrender",this._updatePicker,this)))}},{key:"_onInstanceRemoved",value:function(e){this._initialize();var t=this._hotspots.find((function(t){return t.script===e}));t&&(this._hotspots.splice(this._hotspots.indexOf(t),1),0===this._hotspots.length&&this._picker.app.off("postrender",this._updatePicker,this))}},{key:"_initialize",value:function(){if(!this._picker){var e=wa.Application.getApplication();if(!e)throw new Error("No Playcanvas application running!");this._picker=new wa.Picker(e,256,256),this._pickerPixels=new Uint8Array(262144),this._pickerMaterial=new wa.BasicMaterial;var t=wa.createSphere(e.graphicsDevice,{radius:1}),n=new wa.GraphNode,i=new wa.MeshInstance(n,t,a._pickerMaterial),r=new wa.Model;r.graph=n,r.meshInstances=[i],this._pickerModel=r,this._setPickerMaterialVisible(!1)}}},{key:"_setPickerMaterialVisible",value:function(e){this._pickerMaterial.redWrite=e,this._pickerMaterial.greenWrite=e,this._pickerMaterial.blueWrite=e,this._pickerMaterial.alphaWrite=e,this._pickerMaterial.depthWrite=e}},{key:"_getActiveCamera",value:function(){this._initialize();var e=this._picker.app.systems.camera.cameras;return e[e.length-1]}},{key:"_updatePicker",value:function(){this._initialize();var e=this._picker,t=this._getActiveCamera();if(t){var a=e.app.graphicsDevice,n=256/a.width,i=256/a.height,r=Object(u.a)(this._tempVecs,2),o=r[0],s=r[1],l=t.entity.getPosition();this._hotspots.forEach((function(a){var r=a.script,c=a.pickerPosition;if(r._pickerEntity){var u=r._pickerEntity.getPosition(),h=u.distance(l);t.worldToScreen(u,o),t.screenToWorld(o.x+r.colliderScreenRadius,o.y,h,s);var d=s.distance(u);r._pickerEntity.setLocalScale(d,d,d),c.x=Math.floor(o.x*n),c.y=Math.floor(o.y*i),c.y=Math.floor(e.height-1-c.y)}}));var c=e.app.scene.layers.getLayerById(wa.LAYERID_WORLD);this._setPickerMaterialVisible(!0),e.prepare(t,e.app.scene,c),this._setPickerMaterialVisible(!1);var h=a.getRenderTarget();a.setRenderTarget(e.layer.renderTarget),a.updateBegin(),a.readPixels(0,0,256,256,this._pickerPixels),a.updateEnd(),a.setRenderTarget(h)}}},{key:"_isHotspotVisible",value:function(e){var t,a,n=this._hotspots.find((function(t){return t.script===e}));if(!n)return!1;var i=this._picker,r=this._pickerPixels,o=i.layer.instances.visibleOpaque[0].list,s=n.pickerPosition,l=s.x,c=s.y*i.width+l,u=r[4*c+0]<<16|r[4*c+1]<<8|r[4*c+2];return 16777215!==u&&(null===(t=o[u])||void 0===t||null===(a=t.node)||void 0===a?void 0:a.parent)===e._pickerEntity}}]),a}(wa.ScriptType);Da._picker=void 0,Da._pickerPixels=void 0,Da._pickerModel=void 0,Da._pickerMaterial=void 0,Da._hotspots=[],Da._tempVecs=[new wa.Vec3,new wa.Vec3,new wa.Vec3],Da.attributes.add("image",{type:"asset",assetType:"texture",title:"Image",description:""}),Da.attributes.add("hoveredImage",{type:"asset",assetType:"texture",default:null,title:"Hovered image",description:""}),Da.attributes.add("toggledImage",{type:"asset",assetType:"texture",default:null,title:"Toggled image",description:""}),Da.attributes.add("toggledHoveredImage",{type:"asset",assetType:"texture",default:null,title:"Toggled hovered image",description:""}),Da.attributes.add("transitionDuration",{type:"number",default:0,title:"Transition duration (ms)",description:"Duration of transition when toggling between images for states."}),Da.attributes.add("parentElementId",{type:"string",default:"",title:"Element ID",description:"The ID of the element that should parent the hotspot."}),Da.attributes.add("cacheEntityPosition",{type:"boolean",default:!1,title:"Cache entity position",description:"Cache entity world position on initialize instead of reading from entity on every frame."}),Da.attributes.add("colliderScreenRadius",{type:"number",default:10,title:"Radius of collider in pixels",description:"Used for determining if a hotspot is visible or hidden behind other geometry."});var Ta=function(e){Object(Oa.a)(a,e);var t=Object(Ea.a)(a);function a(){var e;Object(V.a)(this,a);for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i)))._skyEntity=void 0,e._material=new wa.Material,e._lightComponent=void 0,e._time=0,e._defaultHorizonSunColor=new wa.Color(1,.221,.04),e._defaultZenithSunColor=new wa.Color(.954,.901,.74412),e._entityRotation=new wa.Quat,e._lightDir=new wa.Vec3,e._tempColor=new wa.Color,e._tempQuat=new wa.Quat,e}return Object(B.a)(a,[{key:"initialize",value:function(){a._instanceCount+=1,this._skyEntity=new wa.Entity("Sky"),this._skyEntity.tags.add("ignoreBoundingBox"),this._skyEntity.addComponent("model"),this.entity.addChild(this._skyEntity),this._initializeMaterial(),this._cacheLightComponent(),this._updateModel(),this._updateTextures(),this._updateSettings(),this._updateColors(),this._updateSun(),this.on("attr:skySphereModel",this._updateModel,this),this.on("attr:scale",this._updateSkySphereSize,this),this.on("attr:skyTexture",this._updateTextures,this),this.on("attr:cloudsTexture",this._updateTextures,this),this.on("attr:starsTexture",this._updateTextures,this),this.on("attr:directionalLight",this._cacheLightComponent,this),this.on("attr:sunBrightness",this._updateSettings,this),this.on("attr:starsBrightness",this._updateSettings,this),this.on("attr:cloudSpeed",this._updateSettings,this),this.on("attr:cloudOpacity",this._updateSettings,this),this.on("attr:horizonFalloff",this._updateColors,this),this.on("attr:sunRadius",this._updateSettings,this),this.on("attr:noisePower1",this._updateSettings,this),this.on("attr:noisePower2",this._updateSettings,this),this.on("attr:zenithColor",this._updateColors,this),this.on("attr:horizonColor",this._updateColors,this),this.on("attr:cloudColor",this._updateColors,this),this.on("attr:overallColor",this._updateColors,this),this.on("attr:zenithColorCurve",this._updateColors,this),this.on("attr:horizonColorCurve",this._updateColors,this),this.on("attr:cloudColorCurve",this._updateColors,this),this.on("attr:colorsDeterminedBySunPosition",this._updateColors,this);var e=this.app.scene.layers.getLayerById(wa.LAYERID_SKYBOX);1===a._instanceCount&&e&&(a._skyboxWasInitiallyEnabled=e.enabled,e.enabled=!1),this.on("destroy",(function(){a._instanceCount-=1,0===a._instanceCount&&e&&(e.enabled=a._skyboxWasInitiallyEnabled)}))}},{key:"postUpdate",value:function(e){this._time+=e,this._material.setParameter("uTime",this._time),this._restrictSkyRotation(),this._updateSun()}},{key:"_restrictSkyRotation",value:function(){var e=this.entity.getRotation();e.equals(this._entityRotation)||(this._entityRotation.copy(e),this._skyEntity.setRotation(wa.Quat.IDENTITY))}},{key:"_cacheLightComponent",value:function(){var e;this._lightComponent=null===(e=this.directionalLight)||void 0===e?void 0:e.findComponent("light")}},{key:"_updateModel",value:function(){var e=this.skySphereModel,t=this._skyEntity.model,a=this._material;if(e){var n=e.resource.clone();t.model=n,n.meshInstances.forEach((function(e){return e.material=a}))}else t.model=null;this._updateSkySphereSize()}},{key:"_updateSkySphereSize",value:function(){var e,t=this._skyEntity;t.setLocalScale(this.scale);var a=this._calculateModelSphereRadius(null===(e=t.model)||void 0===e?void 0:e.model);this._material.setParameter("uObjectRadius",a)}},{key:"_updateTextures",value:function(){this._setTextureParameter("uSkyMap",this.skyTexture),this._setTextureParameter("uCloudsMap",this.cloudsTexture),this._setTextureParameter("uStarsMap",this.starsTexture)}},{key:"_updateSettings",value:function(){var e=this._material;e.setParameter("uCloudSpeed",this.cloudSpeed),e.setParameter("uNoisePower1",this.noisePower1),e.setParameter("uNoisePower2",this.noisePower2),e.setParameter("uSunRadius",this.sunRadius),e.setParameter("uCloudOpacity",this.cloudOpacity),e.setParameter("uStarsBrightness",this.starsBrightness),e.setParameter("uSunBrightness",this.sunBrightness)}},{key:"_updateColors",value:function(){var e=this._material;if(this.colorsDeterminedBySunPosition){var t=wa.math.clamp(this.sunHeight,-1,1);e.setParameter("uHorizonColor",this.horizonColorCurve.value(t)),e.setParameter("uZenithColor",this.zenithColorCurve.value(t)),e.setParameter("uCloudColor",this.cloudColorCurve.value(t)),e.setParameter("uHorizonFalloff",wa.math.lerp(3,7,Math.abs(t)))}else this._setVectorParameter("uCloudColor",this.cloudColor),this._setVectorParameter("uHorizonColor",this.horizonColor),this._setVectorParameter("uZenithColor",this.zenithColor),e.setParameter("uHorizonFalloff",this.horizonFalloff);this._setVectorParameter("uOverallColor",this.overallColor)}},{key:"_updateSun",value:function(){var e=this._lightComponent,t=this._lightDir,a=this._tempColor,n=this._tempQuat;if(e){var i=e.color;e.entity.getRotation().transformVector(wa.Vec3.DOWN,t),a.set(i.r,i.g,i.b),this.sunHeight=180*Math.asin(-t.y)/Math.PI/90}else{this.entity.getRotation().transformVector(wa.Vec3.FORWARD,t);var r=90*-wa.math.clamp(this.sunHeight,-1,1),o=Math.atan2(-t.x,-t.z)*wa.math.RAD_TO_DEG;n.setFromEulerAngles(r,o,0),n.transformVector(wa.Vec3.FORWARD,t);var s=this._defaultHorizonSunColor,l=this._defaultZenithSunColor,c=wa.math.clamp(this.sunHeight+.2,0,1);a.lerp(s,l,c)}this._setVectorParameter("uLightDirection",t),this._setVectorParameter("uSunColor",a),this._material.setParameter("uSunHeight",Math.abs(Math.min(this.sunHeight,0))),this.colorsDeterminedBySunPosition&&this._updateColors()}},{key:"_setTextureParameter",value:function(e,t){var a=this._material,n=null==t?void 0:t.resource;n?a.setParameter(e,n):a.deleteParameter(e)}},{key:"_setVectorParameter",value:function(e,t){var a=this._material;t instanceof wa.Vec3?a.setParameter(e,[t.x,t.y,t.z]):t instanceof wa.Color?a.setParameter(e,[t.r,t.g,t.b]):a.setParameter(e,t)}},{key:"_calculateModelSphereRadius",value:function(e){if(!e)return 0;var t=e.meshInstances;if(!t||t.length<1)return 0;var a=new wa.BoundingBox;a.copy(t[0].aabb),t.slice(1).forEach((function(e){return a.add(e.aabb)}));var n=[],i=new wa.Vec3,r=new wa.Vec3,o=0,s=e.graph.getWorldTransform();return t.forEach((function(e){for(var t=e.mesh.getPositions(n),l=0;l<t;l+=3)i.set(n[3*l+0],n[3*l+1],n[3*l+2]),s.transformPoint(i,i),r.sub2(i,a.center),o=Math.max(o,r.lengthSq())})),Math.sqrt(o)}},{key:"_initializeMaterial",value:function(){var e=this.app.graphicsDevice,t=e.precision,a=this._getVertexShaderCode(),n=this._getFragmentShaderCode(),i=new wa.Shader(e,{attributes:{aPosition:wa.SEMANTIC_POSITION,aUv0:wa.SEMANTIC_TEXCOORD0,aUv1:wa.SEMANTIC_TEXCOORD1},vshader:a,fshader:"precision ".concat(t," float;\n ").concat(n)});this._material.shader=i}},{key:"_getVertexShaderCode",value:function(){return"\n      attribute vec4 aPosition;\n      attribute vec2 aUv0;\n      attribute vec2 aUv1;\n      \n      uniform mat4 matrix_model;\n      uniform mat4 matrix_viewProjection;\n\n      varying vec3 vWorldObjectPosition;\n      varying vec3 vWorldPosition;\n      varying vec2 vUv0;\n      varying vec2 vUv1;\n      \n      void main(void)\n      {\n        vec4 worldObjectPosition = matrix_model * vec4(0.0, 0.0, 0.0, 1.0);\n        vec4 worldPosition = matrix_model * aPosition;\n\n        vWorldObjectPosition = worldObjectPosition.xyz;\n        vWorldPosition = worldPosition.xyz;\n        vUv0 = aUv0;\n        vUv1 = aUv1;\n\n        gl_Position = matrix_viewProjection * worldPosition;\n      }\n    "}},{key:"_getFragmentShaderCode",value:function(){var e=this.app.scene,t=wa.programlib,a="";return a+=t.gammaCode(e.gammaCorrection),a+=t.tonemapCode(e.toneMapping),a+="\n      uniform vec3 view_position;\n      uniform vec3 uLightDirection;\n      uniform float uObjectRadius;\n\n      uniform sampler2D uSkyMap;\n      uniform sampler2D uCloudsMap;\n      uniform sampler2D uStarsMap;\n\n      uniform float uCloudSpeed;\n      uniform float uNoisePower1;\n      uniform float uNoisePower2;\n      uniform float uHorizonFalloff;\n      uniform float uSunRadius;\n      uniform float uCloudOpacity;\n      uniform float uStarsBrightness;\n      uniform float uSunBrightness;\n      uniform float uSunHeight;\n      uniform float uTime;\n\n      uniform vec3 uCloudColor;\n      uniform vec3 uOverallColor;\n      uniform vec3 uHorizonColor;\n      uniform vec3 uZenithColor;\n      uniform vec3 uSunColor;\n\n      varying vec3 vWorldObjectPosition;\n      varying vec3 vWorldPosition;\n      varying vec2 vUv0;\n      varying vec2 vUv1;\n\n      struct HorizonDistribution\n      {\n        float cloudAlpha;\n        float horizonAlpha;\n      };\n\n      struct CloudTextures\n      {\n        float base;\n        float exp;\n      };\n\n      struct SkyColors\n      {\n        vec3 color;\n      };\n\n      struct SunVector\n      {\n        float sunDotProduct;\n      };\n\n      struct Sun\n      {\n        vec3 color;\n      };\n\n      struct RimLight\n      {\n        vec3 color;\n        float rimLightAlpha;\n      };\n\n      float saturate(float source)\n      {\n        return clamp(source, 0.0, 1.0);\n      }\n\n      float sphereMask(float a, float b, float radius, float hardness)\n      {\n        float invRadius = 1.0 / max(radius, 0.00001);\n        float invHardness = 1.0 / max(1.0 - hardness, 0.00001);\n\n        float normalizeDistance = abs(a - b) * invRadius;\n        float negNormalizedDistance = 1.0 - normalizeDistance;\n        float maskUnclamped = negNormalizedDistance * invHardness;\n\n        return saturate(maskUnclamped);\n      }\n\n      void evalHorizonDistribution(vec3 cameraVector, out HorizonDistribution results)\n      {\n        results.cloudAlpha = saturate(dot(cameraVector, vec3(0.0, -1.0, 0.0)));\n        results.horizonAlpha = saturate(pow((1.0 - results.cloudAlpha), uHorizonFalloff * 2.0));  // TODO: Find out we need a higher falloff in the viewer to match Unreal\n      }\n\n      void evalCloudTextures(in HorizonDistribution horizonDistribution, out CloudTextures results)\n      {\n        float time = uTime * uCloudSpeed;\n        vec3 position = (vWorldPosition - vWorldObjectPosition) / (uObjectRadius * -0.1);\n\n        vec2 skyUv = vUv0 + vec2(time * 0.0002, 0.0);\n        vec2 cloudUv = vUv0 + vec2(time * 0.001, 0.0);\n\n        float skySample = gammaCorrectInput(texture2D(uSkyMap, skyUv)).r;\n        float cloudSample = gammaCorrectInput(texture2D(uCloudsMap, cloudUv)).r;\n        float mixedSample = mix(skySample, cloudSample, horizonDistribution.cloudAlpha);\n        \n        float heightAlpha = (1.0 - saturate(position.y)) * uCloudOpacity;\n        vec2 noiseUv = vec2(1.0) - ((vec2(1.0) - vUv0) * 0.5); // TODO: Find out why we need this inversion when scaling to match Unreal\n        float noiseAlpha = gammaCorrectInput(texture2D(uCloudsMap, noiseUv)).r;\n\n        results.base = mix(0.0, mixedSample, heightAlpha);\n        results.exp = mix(uNoisePower1, uNoisePower2, noiseAlpha);\n      }\n\n      void evalSkyColors(in HorizonDistribution horizonDistribution, out SkyColors results)\n      {\n        vec3 starsSample = gammaCorrectInput(texture2D(uStarsMap, vUv1 * 12.0)).rgb;\n        vec3 starsColor = starsSample * uStarsBrightness * uSunHeight + uZenithColor;\n\n        results.color = mix(starsColor, uHorizonColor, horizonDistribution.horizonAlpha);\n      }\n\n      void evalSunVector(vec3 cameraVector, vec3 lightDirection, out SunVector results)\n      {\n        results.sunDotProduct = dot(lightDirection, cameraVector);\n      }\n\n      void evalSun(in SunVector sunVector, out Sun results)\n      {\n        float sunSphereMask = sphereMask(sunVector.sunDotProduct, 1.0, uSunRadius, 0.0);\n        \n        results.color = uSunColor * uSunBrightness * sunSphereMask;\n      }\n\n      void evalRimLight(in CloudTextures cloudTextures, in SunVector sunVector, out RimLight results)\n      {\n        float cloudStrength = pow(cloudTextures.base, cloudTextures.exp);\n        float cloudStrengthSq = cloudStrength * cloudStrength;\n\n        float sphereMask = sphereMask(sunVector.sunDotProduct, 1.0, 1.3, 0.0);\n\n        vec3 cloudColor = uCloudColor * cloudStrength;\n        vec3 rimColor = uSunColor * saturate(pow(sphereMask, 10.0)) * cloudStrengthSq * 0.4;\n\n        results.color = cloudColor + rimColor;\n        results.rimLightAlpha = saturate(cloudStrengthSq);\n      }\n\n      void main(void)\n      {\n        Sun sun;\n        RimLight rimLight;\n        SunVector sunVector;\n        SkyColors skyColors;\n        CloudTextures cloudTextures;\n        HorizonDistribution horizonDistribution;\n\n        vec3 lightDir = normalize(uLightDirection);\n        vec3 viewDir = normalize(vWorldPosition - view_position);\n        vec3 cameraVector = -viewDir;\n        \n        evalHorizonDistribution(cameraVector, horizonDistribution);\n        evalSkyColors(horizonDistribution, skyColors);\n        evalCloudTextures(horizonDistribution, cloudTextures);\n        evalSunVector(cameraVector, lightDir, sunVector);\n        evalSun(sunVector, sun);\n        evalRimLight(cloudTextures, sunVector, rimLight);\n\n        vec3 outputColor = mix(sun.color + skyColors.color, rimLight.color, rimLight.rimLightAlpha);\n        outputColor *= uOverallColor;\n        outputColor *= 1.5;\n\n        outputColor = toneMap(outputColor);\n        outputColor = gammaCorrectOutput(outputColor);\n\n        gl_FragColor = vec4(outputColor, 1.0);\n      }\n    "}}]),a}(wa.ScriptType);function Aa(e){var t;return(null!==(t=e.camera)&&void 0!==t?t:e.addComponent("camera")).clearColor=new wa.Color(0,0,0),e.script||e.addComponent("script"),e}function Ra(e){var t,a;return null!==(t=null===(a=e.script)||void 0===a?void 0:a.has("OrbitCamera"))&&void 0!==t&&t}Ta._skyboxWasInitiallyEnabled=!1,Ta._instanceCount=0,Ta.attributes.add("skySphereModel",{type:"asset",assetType:"model",title:"Sky-sphere model"}),Ta.attributes.add("skyTexture",{type:"asset",assetType:"texture",title:"Sky texture"}),Ta.attributes.add("cloudsTexture",{type:"asset",assetType:"texture",title:"Clouds texture"}),Ta.attributes.add("starsTexture",{type:"asset",assetType:"texture",title:"Stars texture"}),Ta.attributes.add("directionalLight",{type:"entity",title:"Assign your scenes's directional light entity to this variable to  match the sky's sun position and color"}),Ta.attributes.add("sunHeight",{type:"number",default:0,title:"If no directional light is assigned, this value determines the height of the sun"}),Ta.attributes.add("sunBrightness",{type:"number",default:50,title:"Brightness multiplier for the sun disk"}),Ta.attributes.add("starsBrightness",{type:"number",default:.1,title:"Multiplier for the brightness of the stars when the sun is below the horizon"}),Ta.attributes.add("cloudSpeed",{type:"number",default:1,title:"Panning speed for the clouds"}),Ta.attributes.add("cloudOpacity",{type:"number",default:.7,title:"Opacity of the panning clouds"}),Ta.attributes.add("horizonFalloff",{type:"number",default:3,title:"Affects the size of the gradient from zenith color to horizon color"}),Ta.attributes.add("sunRadius",{type:"number",default:3e-4,title:"Size of the sun disc"}),Ta.attributes.add("noisePower1",{type:"number",default:1,title:"Cloud noise 1"}),Ta.attributes.add("noisePower2",{type:"number",default:4,title:"Cloud noise 2"}),Ta.attributes.add("colorsDeterminedBySunPosition",{type:"boolean",default:!0,title:"If enabled, sky colors will change according to the sun's position"}),Ta.attributes.add("zenithColor",{type:"vec3",default:[.034046,.109247,.295],title:"Zenith color (HDR)"}),Ta.attributes.add("horizonColor",{type:"rgb",default:[1.979559,2.586644,3],title:"Horizon color (HDR)"}),Ta.attributes.add("cloudColor",{type:"rgb",default:[.855778,.91902,1],title:"Cloud color (HDR)"}),Ta.attributes.add("overallColor",{type:"rgb",default:[1,1,1],title:"Overall color (HDR)"}),Ta.attributes.add("zenithColorCurve",{type:"curve",color:"rgb",default:{keys:[[-1,0,-.4,.08,0,.23,.1,.27,.2,.08,.3,.05,.5,.02],[-1,0,-.4,.07,0,.1,.1,.15,.2,.13,.3,.09,.5,.05],[-1,0,-.4,.08,0,.09,.1,.13,.2,.19,.3,.21,.5,.12]]},title:"Zenith color curve. The keys (time) correspond to sunHeight values"}),Ta.attributes.add("horizonColorCurve",{type:"curve",color:"rgb",default:{keys:[[-1,.048,-.6,.386,0,2,.2,1.943,.4,.703,.5,.92],[-1,.052,-.6,.131,0,.6,.2,.613,.4,1.048,.5,1.322],[-1,.075,-.6,.111,0,.2,.2,.283,.4,1.669,.5,2]]},title:"Horizon color curve. The keys (time) correspond to sunHeight values"}),Ta.attributes.add("cloudColorCurve",{type:"curve",color:"rgb",default:{keys:[[-.8,.054,-.5,.198,-.2,.684,.2,.81,.4,.857,.8,.93],[-.8,.059,-.5,.139,-.2,.415,.2,.514,.4,.81,.8,.95],[-.8,.065,-.5,.129,-.2,.304,.2,.407,.4,.806,.8,1]]},title:"Cloud color curve. The keys (time) correspond to sunHeight values"}),Ta.attributes.add("scale",{type:"vec3",default:[1,1,1],title:"Sky Sphere scale"});var Ia=a(77),Fa=a(78),Va=a.n(Fa),za=a(79),Ba=ga()("Variant"),Ua=function(){function e(t,a,n,i){Object(V.a)(this,e),this.name=t,this.thumbnailSource=a,this._isActiveByDefault=n,this._variantNodes=i,n&&this.activate()}return Object(B.a)(e,[{key:"active",get:function(){var e=this;return this._variantNodes.every((function(t){var a,n=t.node,i=t.properties,r=i.visible,o=i.modelAssetID,s=i.materialMapping,l=void 0===r||r===n.enabled,c=void 0===o||o===(null===(a=n.model)||void 0===a?void 0:a.asset),u=void 0===s||e._hasMatchingMaterials(s,n.model);return l&&c&&u}))}},{key:"activate",value:function(){this._variantNodes.forEach((function(e){var t=e.node,a=e.properties;if(void 0!==a.modelAssetID&&void 0!==t.model){Ba("Set node mesh",t.name,a.modelAssetID);var n=a.modelAssetID;if(t.model.asset!==n){var i=t.anim;delete t.anim,t.model.asset=n,t.anim=i}}void 0!==a.visible&&(Ba("Set node visibility",t.name,a.visible),t.enabled=a.visible),void 0!==a.materialMapping&&void 0!==t.model&&(Ba("Set node materials",t.name,a.materialMapping),t.model.mapping=a.materialMapping)})),this._variantNodes.forEach((function(e){var t,a=null===(t=e.node.script)||void 0===t?void 0:t.NodeLightmap;a&&a.applyLightmapToModel()}))}},{key:"_hasMatchingMaterials",value:function(e,t){var a,n;if(!(null==t?void 0:t.meshInstances))return!1;if(Object.keys(e).length<1)return!1;var i=wa.Application.getApplication(),r=null==i||null===(a=i.assets.get(t.asset))||void 0===a||null===(n=a.data)||void 0===n?void 0:n.mapping;return t.meshInstances.every((function(t,a){var n,o=void 0!==e[a]?e[a]:null==r||null===(n=r[a])||void 0===n?void 0:n.material,s=null==i?void 0:i.assets.get(o),l=null==s?void 0:s.resource;return!!l&&l===t.material}))}}]),e}(),Na=ga()("VariantSetManager"),Ha=function(){function e(t){var a=this;Object(V.a)(this,e),this._state=void 0,this._stateCallbacks=void 0,this._globalStateCallbacks=[],this._levelVariantSets=void 0,this._variantSets=void 0,this._levelVariantSets=[],this._variantSets=[],t.forEach((function(e){var t=e.name,n=e.variantSets,i={name:t,variantSets:[]};n.forEach((function(e){var t=a._variantSets.push(e)-1;i.variantSets.push(t)})),a._levelVariantSets.push(i)})),this._stateCallbacks=this._variantSets.map((function(e){return[]})),this._state=this._evalGlobalState()}return Object(B.a)(e,[{key:"globalState",get:function(){return this._state}},{key:"levelVariantSets",get:function(){return this._levelVariantSets}},{key:"getName",value:function(e){var t;return null===(t=this._variantSets[e])||void 0===t?void 0:t.name}},{key:"getVariantIds",value:function(e){var t,a;return null!==(t=null===(a=this._variantSets[e])||void 0===a?void 0:a.variants.map((function(e,t){return t})))&&void 0!==t?t:[]}},{key:"getVariantNames",value:function(e){var t,a;return null!==(t=null===(a=this._variantSets[e])||void 0===a?void 0:a.variants.map((function(e){return e.name})))&&void 0!==t?t:[]}},{key:"getVariantThumbnails",value:function(e){var t,a;return null!==(t=null===(a=this._variantSets[e])||void 0===a?void 0:a.variants.map((function(e){return e.thumbnailSource})))&&void 0!==t?t:[]}},{key:"getState",value:function(e){return this.globalState[e]}},{key:"activate",value:function(e,t){var a,n=this;if(Na("Activate variant",t,"for variant set",e),void 0===this._state[e])throw new Error("Invalid variant set ".concat(e));var i=null===(a=this._variantSets[e])||void 0===a?void 0:a.variants[t];if(void 0===i)throw new Error("Invalid variant ".concat(t," for variant set ").concat(e));i.activate();var r=this._evalGlobalState();r.forEach((function(e,t){var a,i;a=n._state[t],i=e,JSON.stringify(a)!==JSON.stringify(i)&&(Na("State for variant set",t,"changed from",n._state[t],"to",e),n._onStateChange(t,e))})),this._state=r,this._onGlobalStateChange()}},{key:"onStateChange",value:function(e,t){var a=this._stateCallbacks[e];if(void 0===a)throw new Error("Invalid variant set ".concat(e));a.indexOf(t)>-1||a.push(t)}},{key:"offStateChange",value:function(e,t){var a=this._stateCallbacks[e];if(void 0===a)throw new Error("Invalid variant set ".concat(e));var n=a.indexOf(t);-1!==n&&a.splice(n,1)}},{key:"onGlobalStateChange",value:function(e){var t=this._globalStateCallbacks;t.indexOf(e)>-1||t.push(e)}},{key:"offGlobalStateChange",value:function(e){var t=this._globalStateCallbacks,a=t.indexOf(e);-1!==a&&t.splice(a,1)}},{key:"_onStateChange",value:function(e,t){this._stateCallbacks[e].forEach((function(e){return e(t)}))}},{key:"_onGlobalStateChange",value:function(){var e=this;this._globalStateCallbacks.forEach((function(t){return t(e.globalState)}))}},{key:"_evalGlobalState",value:function(){return this._variantSets.map((function(e){return e.variants.reduce((function(e,t,a){return t.active&&e.push(a),e}),[])}))}}]),e}(),Wa=ga()("AnimationPlayback"),Ga=!0,Za=!0,Ya=1,qa=0,Xa=function(){function e(){Object(V.a)(this,e),this._animDatas=[]}return Object(B.a)(e,[{key:"name",get:function(){return"EPIC_animation_playback"}},{key:"getPlaybackByAnimationIndex",value:function(e){var t=this;return e.animations.map((function(e){var a;return null===(a=t._animDatas.find((function(t){var a=t.anim;return e.resource===a})))||void 0===a?void 0:a.data}))}},{key:"register",value:function(e){e.animation.add(this.name,{postParse:this._animationPostParse.bind(this)})}},{key:"unregister",value:function(e){e.texture.remove(this.name)}},{key:"postParse",value:function(){}},{key:"_animationPostParse",value:function(e,t){Wa("Parse animation play data",e,t),this._animDatas.push({anim:e,data:t})}}]),e}(),Qa=ga()("BlendMode"),$a=function(){function e(){Object(V.a)(this,e)}return Object(B.a)(e,[{key:"name",get:function(){return"EPIC_blend_modes"}},{key:"register",value:function(e){e.material.add(this.name,{postParse:this._materialPostParse.bind(this)})}},{key:"unregister",value:function(e){e.texture.remove(this.name)}},{key:"postParse",value:function(){}},{key:"_materialPostParse",value:function(e,t){switch(Qa("Parse Blend mode",e,t),t.blendMode){case"ADDITIVE":e.blendType=wa.BLEND_ADDITIVEALPHA;break;case"MODULATE":e.blendType=wa.BLEND_MULTIPLICATIVE;break;case"ALPHACOMPOSITE":e.blendType=wa.BLEND_PREMULTIPLIED}}}]),e}(),Ka=function(){function e(){Object(V.a)(this,e),this._extensions={},this.add=this.add.bind(this),this.remove=this.remove.bind(this),this.removeAll=this.removeAll.bind(this),this.find=this.find.bind(this),this.index=this.index.bind(this),this.postParse=this.postParse.bind(this),this.postParse=this.postParse.bind(this)}return Object(B.a)(e,[{key:"add",value:function(e,t){return!this._extensions[e]&&(this._extensions[e]=t,!0)}},{key:"remove",value:function(e){this._extensions[e]&&delete this._extensions[e]}},{key:"removeAll",value:function(){this._extensions={}}},{key:"find",value:function(e){if(this._extensions[e])return this._extensions[e]}},{key:"index",value:function(){return this._extensions}},{key:"postParse",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=this._extensions;Object.keys(t).forEach((function(i){var r=n[i];r&&r.postParse&&r.postParse(e,t[i],a)}))}}]),e}(),Ja=function(){function e(){Object(V.a)(this,e),this._node=new Ka,this._scene=new Ka,this._camera=new Ka,this._texture=new Ka,this._material=new Ka,this._animation=new Ka,this.removeAll=this.removeAll.bind(this)}return Object(B.a)(e,[{key:"node",get:function(){return this._node}},{key:"scene",get:function(){return this._scene}},{key:"camera",get:function(){return this._camera}},{key:"texture",get:function(){return this._texture}},{key:"material",get:function(){return this._material}},{key:"animation",get:function(){return this._animation}},{key:"containerAssetOptions",get:function(){var e,t=this;function a(t){return function(a,n){a.extensions&&(e?t.postParse(n,a.extensions,e):console.error("Gltf data was not loaded before postParse, skipping postParse extensions for",a))}}return{global:{preprocess:function(t){return e=t}},node:{postprocess:a(this.node)},scene:{postprocess:a(this.scene)},camera:{postprocess:a(this.camera)},texture:{postprocess:function(e,a){e.extensions&&t.texture.postParse(a.resource,e.extensions)}},material:{postprocess:a(this.material)},animation:{postprocess:a(this.animation)}}}},{key:"removeAll",value:function(){this._node.removeAll(),this._scene.removeAll(),this._camera.removeAll(),this._texture.removeAll(),this._material.removeAll(),this._animation.removeAll()}}]),e}(),en=ga()("HdrEncoding"),tn=function(){function e(){Object(V.a)(this,e)}return Object(B.a)(e,[{key:"name",get:function(){return"EPIC_texture_hdr_encoding"}},{key:"register",value:function(e){e.texture.add(this.name,{postParse:this._texturePostParse.bind(this)})}},{key:"unregister",value:function(e){e.texture.remove(this.name)}},{key:"postParse",value:function(){}},{key:"_texturePostParse",value:function(e,t){en("Parse HDR encoding",e,t),"RGBM"===t.encoding&&(e.type=wa.TEXTURETYPE_RGBM)}}]),e}();function an(e,t){var a=e._colorBuffer;if(a.format===wa.PIXELFORMAT_R8_G8_B8_A8){var n=new Uint8Array(a.width*a.height*4),i=t.gl;t.setFramebuffer(e._glFrameBuffer),i.readPixels(0,0,a.width,a.height,i.RGBA,i.UNSIGNED_BYTE,n),a._levels||(a._levels=[]),a._levels[0]||(a._levels[0]=[]);for(var r=0;r<6;r+=1)a._levels[0][r]=n}}function nn(e,t,a){if(e.type!==wa.TEXTURETYPE_RGBM)throw new Error("The source cubemap must use RGBM-encoding");if(e.width<128)throw new Error("The source cubemap must have a size of 128 or more");var n=(null==a?void 0:a.syncToCpu)||(null==a?void 0:a.createMipChainInFirstMip);e.width>128&&((e=function(e,t,a,n){var i=Math.round(Math.log2(e.width))-Math.round(Math.log2(t));if(i<0)throw new Error("Output-size must be less or equal than source-size");for(var r=e.type,o=e.format,s=wa.shaderChunks,l=s.createShaderFromCode(a,s.fullscreenQuadVS,s.outputCubemapPS,"outputCubemap"),c=a.scope.resolve("source"),u=a.scope.resolve("params"),h=new wa.Vec4,d=e,p=e,m=0;m<i;m+=1){var v=.5*d.width;p=new wa.Texture(a,{cubemap:!0,name:"prefiltered-cube",type:r,format:o,width:v,height:v,mipmaps:!1});for(var f=0;f<6;f+=1){var g=new wa.RenderTarget({colorBuffer:p,face:f,depth:!1});h.x=f,c.setValue(e),u.setValue(h.data),wa.drawQuadWithShader(a,g,l),n&&an(g,a)}d=p}return p}(e,128,t,n)).name="prefiltered-cube-128");for(var i=[128,64,32,16,8,4],r=[0,512,128,32,8,2],o=i.map((function(a,n){return 0===n?e:new wa.Texture(t,{cubemap:!0,mipmaps:!1,name:"prefiltered-cube-".concat(a),type:e.type,format:e.format,fixCubemapSeams:!0,width:a,height:a,addressU:wa.ADDRESS_CLAMP_TO_EDGE,addressV:wa.ADDRESS_CLAMP_TO_EDGE})})),s=wa.shaderChunks,l=s.createShaderFromCode(t,s.fullscreenQuadVS,s.rgbmPS+s.prefilterCubemapPS.replace(/\$METHOD/g,"phong").replace(/\$NUMSAMPLES/g,4096).replace(/\$textureCube/g,"textureCubeRGBM"),"prefilterRgbmCubemap"),c=t.scope.resolve("source"),u=t.scope.resolve("params"),h=new wa.Vec4,d=1;d<i.length;d+=1)for(var p=0;p<6;p+=1){var m=new wa.RenderTarget({colorBuffer:o[d],face:p,depth:!1});h.x=p,h.y=r[d],h.z=i[d],h.w=2,c.setValue(o[d-1]),u.setValue(h.data),wa.drawQuadWithShader(t,m,l),n&&an(m,t)}if(null==a?void 0:a.createMipChainInFirstMip){for(var v=o[0],f=1;f<i.length;f+=1)v._levels[f]=o[f]._levels[0];v.upload(),v._prefilteredMips=!0}return o}var rn=ga()("HdriBackdrop"),on=function(){function e(){Object(V.a)(this,e),this._nodeBackdrops=[]}return Object(B.a)(e,[{key:"name",get:function(){return"EPIC_hdri_backdrops"}},{key:"register",value:function(e){e.node.add(this.name,{postParse:this._nodePostParse.bind(this)})}},{key:"unregister",value:function(e){e.node.remove(this.name)}},{key:"getBackdropsForScene",value:function(e,t){var a=this,n=wa.Application.getApplication();if(!n)throw new Error("Couldn't find current application");var i=n.graphicsDevice;return this._nodeBackdrops.filter((function(t){return e.findOne((function(e){return e===t.node}))})).map((function(e){var n=e.data,r=e.node,o=a._findCubemapTextures(n,t);if(!o)return rn("Invalid or missing cubemap textures for node ",r.name),null;var s=t.models[n.mesh];if(!s)return rn("Model is missing for node ",r.name),null;var l=function(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=e[0],i=n.width,r=n.height,o=n.format,s=n.type,l=new wa.Texture(t,{cubemap:!0,mipmaps:a,format:o,type:s,width:i,height:r,fixCubemapSeams:!0,addressU:wa.ADDRESS_CLAMP_TO_EDGE,addressV:wa.ADDRESS_CLAMP_TO_EDGE});return l._levels=[[e[0]._levels[0],e[1]._levels[0],e[2]._levels[0],e[3]._levels[0],e[4]._levels[0],e[5]._levels[0]]],l.upload(),l}(o,i,!0);if(!l)return rn("Cubemap could not be created for node ",r.name),null;var c=new wa.Asset("","cubemap");c.resource=l;var u=r.addComponent("script").create(Pa,{enabled:!1,attributes:a._stripUndefinedProperties(Object(na.a)(Object(na.a)({},n),{},{model:s,cubemap:c}))});return{node:r,script:u,cubemap:l,skyboxCubemaps:nn(l,i,{createMipChainInFirstMip:!0}),skyboxIntensity:n.intensity}})).filter((function(e){return null!==e}))}},{key:"postParse",value:function(e){}},{key:"_nodePostParse",value:function(e,t,a){var n,i,r;rn("Parse backdrop",e,t,a);var o=null===(n=a.extensions)||void 0===n||null===(i=n.EPIC_hdri_backdrops)||void 0===i||null===(r=i.backdrops)||void 0===r?void 0:r[t.backdrop];if(o){rn("Found backdrop",o);var s=new wa.Entity(e.name+"_backdrop");e.addChild(s),this._nodeBackdrops.push({node:s,data:o})}}},{key:"_findCubemapTextures",value:function(e,t){var a;if(6!==(null==e||null===(a=e.cubemap)||void 0===a?void 0:a.length))return null;var n=e.cubemap.map((function(e){return t.textures[e]})).map((function(e){return null==e?void 0:e.resource})).filter((function(e){return!!e}));return 6===n.length?n:null}},{key:"_stripUndefinedProperties",value:function(e){var t=Object(na.a)({},e);return Object.keys(t).forEach((function(e){void 0===t[e]&&delete t[e]})),t}}]),e}(),sn=ga()("AnimationHotspot"),ln=function(){function e(){Object(V.a)(this,e),this._hotspotDatas=[],this._hotspots=void 0}return Object(B.a)(e,[{key:"name",get:function(){return"EPIC_animation_hotspots"}},{key:"hotspotAnimationIndices",get:function(){return this._hotspotDatas.map((function(e){return e.data.animation})).filter((function(e,t,a){return void 0!==e&&a.indexOf(e)===t}))}},{key:"getHotspotsForScene",value:function(e,t,a){var n=a.textures;return this._hotspots||(this._hotspots=this._initHotspotScripts(t,n)),this._hotspots.filter((function(t){return e.findOne((function(e){return e===t.entity}))}))}},{key:"register",value:function(e){e.node.add(this.name,{postParse:this._nodePostParse.bind(this)})}},{key:"unregister",value:function(e){e.node.remove(this.name)}},{key:"postParse",value:function(){}},{key:"_nodePostParse",value:function(e,t,a){var n,i;sn("Parse hotspot",e,t,a);var r=null===(n=a.extensions)||void 0===n||null===(i=n.EPIC_animation_hotspots)||void 0===i?void 0:i.hotspots[t.hotspot];r&&(sn("Found hotspot",r),this._hotspotDatas.push({node:e,data:r}))}},{key:"_initHotspotScripts",value:function(e,t){return this._hotspotDatas.filter((function(e){return t[e.data.image]})).map((function(a){var n=e.find((function(e){return e.index===a.data.animation})),i=a.node.addComponent("script").create(Da,{enabled:!1});return i.transitionDuration=200,i.colliderScreenRadius=18,i.image=t[a.data.image],a.data.hoveredImage&&(i.hoveredImage=t[a.data.hoveredImage]),a.data.toggledImage&&(i.toggledImage=t[a.data.toggledImage]),a.data.toggledHoveredImage&&(i.toggledHoveredImage=t[a.data.toggledHoveredImage]),i.onToggle((function(e){sn("Toggle hotspot",e),n&&n.playable&&n.play(e?Yt.Once:Yt.OnceReverse,n.activeStateClipTime)})),i}))}}]),e}(),cn=ga()("CameraControl"),un=function(){function e(){Object(V.a)(this,e),this._focusNodes=[]}return Object(B.a)(e,[{key:"name",get:function(){return"EPIC_camera_controls"}},{key:"register",value:function(e){e.camera.add(this.name,{postParse:this._cameraPostParse.bind(this)})}},{key:"unregister",value:function(e){e.camera.remove(this.name)}},{key:"postParse",value:function(e){cn("Post parse camera control"),this._focusNodes.forEach((function(t){var a,n=t.script,i=t.node;return n.focusEntity=null!==(a=e.nodes[i])&&void 0!==a?a:null}))}},{key:"_cameraPostParse",value:function(e,t){var a,n,i,r,o;cn("Parse camera control",e,t);var s=this._getMissingProperties(t,["mode","maxDistance","minDistance","rotationSensitivity","rotationInertia","dollySensitivity","dollyDuration"]);if(s.length>0)s.forEach((function(t){return cn("Property '".concat(t,"' for camera control '").concat(e.entity.name,"' is missing"))}));else{var l=this._parseOrbitCameraMode(t.mode);if(null!==l){var c=(null!==(a=e.entity.script)&&void 0!==a?a:e.entity.addComponent("script")).create(xa,{enabled:!1});c.mode=l,c.pitchAngleMax=null!==(n=t.maxPitch)&&void 0!==n?n:c.pitchAngleMax,c.pitchAngleMin=null!==(i=t.minPitch)&&void 0!==i?i:c.pitchAngleMin,c.yawAngleMax=null!==(r=t.maxYaw)&&void 0!==r?r:c.yawAngleMax,c.yawAngleMin=null!==(o=t.minYaw)&&void 0!==o?o:c.yawAngleMin,c.distanceMax=t.maxDistance,c.distanceMin=t.minDistance,c.distanceSensitivity=t.dollySensitivity,c.orbitSensitivity=t.rotationSensitivity,c.inertiaFactor=t.rotationInertia,c.dollyDuration=t.dollyDuration,cn("Added orbit camera script",e,c),this._focusNodes.push({script:c,node:t.target})}else cn("Camera mode '".concat(t.mode,"' for camera control '").concat(e.entity.name,"' is invalid"))}}},{key:"_getMissingProperties",value:function(e,t){return t.filter((function(t){return void 0===e[t]}))}},{key:"_parseOrbitCameraMode",value:function(e){var t;if(!e||e.length<2)return null;var a=this._capitalizeFirstLetter(e);return null!==(t=ka[a])&&void 0!==t?t:null}},{key:"_capitalizeFirstLetter",value:function(e){return e.charAt(0).toUpperCase()+e.slice(1)}}]),e}(),hn=ga()("VariantSet"),dn=function(){function e(){Object(V.a)(this,e),this._variantSets=[]}return Object(B.a)(e,[{key:"name",get:function(){return"EPIC_level_variant_sets"}},{key:"getVariantSetsForScene",value:function(e,t){var a=this,n=t.textures,i=t.nodes;return this._variantSets.filter((function(t){return t.scene===e})).reduce((function(e,t){return[].concat(Object(Lt.a)(e),Object(Lt.a)(t.data))}),[]).map((function(e){return{name:e.name,variantSets:e.variantSets.map((function(e){return Object(na.a)(Object(na.a)({},e),{},{variants:e.variants.map((function(e){var r,o,s=e.name,l=e.active,c=e.thumbnail,u=e.nodes;return new Ua(s,void 0!==c?null===(r=null===(o=n[c])||void 0===o?void 0:o.resource)||void 0===r?void 0:r.getSource().src:void 0,l,u.map((function(e){var n=e.node,r=e.properties;return{node:i[n],properties:a._parseVariantNodeProperties(r,t)}})))}))})}))}}))}},{key:"register",value:function(e){e.scene.add(this.name,{postParse:this._scenePostParse.bind(this)})}},{key:"unregister",value:function(e){e.scene.remove(this.name)}},{key:"postParse",value:function(){}},{key:"_scenePostParse",value:function(e,t,a){hn("Parse variant sets",e,t);var n=t.levelVariantSets.map((function(e){var t,n;return null===(t=a.extensions)||void 0===t||null===(n=t.EPIC_level_variant_sets)||void 0===n?void 0:n.levelVariantSets[e]}));n.some((function(e){return void 0===e}))||(hn("Found variant sets",n),this._variantSets.push({scene:e,data:n}))}},{key:"_parseVariantNodeProperties",value:function(e,t){var a,n=e.visible,i=e.materials,r=e.mesh;return{visible:n,materialMapping:null==i?void 0:i.reduce((function(e,a){var n=t.materials[a.material];return n?Object(na.a)(Object(na.a)({},e),{},Object(fe.a)({},a.index,n.id)):e}),{}),modelAssetID:void 0!==r&&-1!==r?null===(a=t.models[r])||void 0===a?void 0:a.id:-1===r?null:void 0}}}]),e}(),pn=ga()("LightMap"),mn=function(){function e(){Object(V.a)(this,e),this._nodeLightmapDatas=[],this._nodeLightmaps=[]}return Object(B.a)(e,[{key:"name",get:function(){return"EPIC_lightmap_textures"}},{key:"register",value:function(e){e.node.add(this.name,{postParse:this._nodePostParse.bind(this)})}},{key:"unregister",value:function(e){e.node.remove(this.name),Ma.clearCachedMaterialMappings()}},{key:"postParse",value:function(e){pn("Post parse lightmap"),this._nodeLightmapDatas.forEach((function(t){var a=t.node,n=t.lightmapScale,i=t.lightmapAdd,r=t.coordinateScaleBias,o=t.texture,s=o.texCoord,l=o.index;if(r&&i&&n&&void 0!==l){var c=e.textures[l];c?a.addComponent("script").create(Ma,{attributes:{texture:c,texCoord:null!=s?s:0,lightmapAdd:i,lightmapScale:n,coordinateScaleBias:r}}):pn("Node '".concat(a.name,"' is using an invalid lightmap texture"))}else pn("Node '".concat(a.name,"' has invalid data"),t)}))}},{key:"_nodePostParse",value:function(e,t,a){var n,i,r;pn("Parse lightmap",e,t,a);var o=null===(n=a.extensions)||void 0===n||null===(i=n.EPIC_lightmap_textures)||void 0===i||null===(r=i.lightmaps)||void 0===r?void 0:r[t.lightmap];o?(pn("Found lightmap",o),this._nodeLightmapDatas.push(Object(na.a)({node:e},o))):pn("Unable to find lightmap with index ".concat(t.lightmap," for node '").concat(e.name,"'"))}}]),e}(),vn=ga()("SkySphere"),fn=function(){function e(){Object(V.a)(this,e),this._nodeSkySphereDatas=[]}return Object(B.a)(e,[{key:"name",get:function(){return"EPIC_sky_spheres"}},{key:"register",value:function(e){e.node.add(this.name,{postParse:this._nodePostParse.bind(this)})}},{key:"unregister",value:function(e){e.node.remove(this.name)}},{key:"postParse",value:function(e){var t=this;vn("Post parse sky sphere"),this._nodeSkySphereDatas.forEach((function(a){var n,i=a.node,r="Sky sphere '".concat(null!==(n=a.name)&&void 0!==n?n:i.name,"'"),o=e.models[a.skySphereMesh];if(o){var s=e.textures[a.skyTexture];if(s){var l=e.textures[a.cloudsTexture];if(l){var c=e.textures[a.starsTexture];if(c){var u=null;if(void 0===a.directionalLight||(u=e.nodes[a.directionalLight])){var h,d,p;if(a.zenithColorCurve){if(!(a.zenithColorCurve.length>=3))return void vn("".concat(r," has an invalid zenithColorCurve"),a.zenithColorCurve);h=new wa.CurveSet(a.zenithColorCurve)}if(a.horizonColorCurve){if(!(a.horizonColorCurve.length>=3))return void vn("".concat(r," has an invalid horizonColorCurve"),a.horizonColorCurve);d=new wa.CurveSet(a.horizonColorCurve)}if(a.cloudColorCurve){if(!(a.cloudColorCurve.length>=3))return void vn("".concat(r," has an invalid cloudColorCurve"),a.cloudColorCurve);p=new wa.CurveSet(a.cloudColorCurve)}i.addComponent("script").create(Ta,{attributes:t._stripUndefinedProperties(Object(na.a)(Object(na.a)({},a),{},{name:void 0,skySphereMesh:void 0,skySphereModel:o,skyTexture:s,cloudsTexture:l,starsTexture:c,directionalLight:u,zenithColorCurve:h,horizonColorCurve:d,cloudColorCurve:p}))})}else vn("".concat(r," has an invalid directional light"),u)}else vn("".concat(r," has an invalid stars texture"),c)}else vn("".concat(r," has an invalid clouds texture"),l)}else vn("".concat(r," has an invalid sky texture"),s)}else vn("".concat(r," has an invalid mesh"),o)}))}},{key:"_nodePostParse",value:function(e,t,a){var n,i,r;vn("Parse sky sphere",e,t,a);var o=null===(n=a.extensions)||void 0===n||null===(i=n.EPIC_sky_spheres)||void 0===i||null===(r=i.skySpheres)||void 0===r?void 0:r[t.skySphere];o&&(vn("Found sky sphere",o),this._nodeSkySphereDatas.push(Object(na.a)({node:e},o)))}},{key:"_stripUndefinedProperties",value:function(e){var t=Object(na.a)({},e);return Object.keys(t).forEach((function(e){void 0===t[e]&&delete t[e]})),t}}]),e}(),gn=ga()(" LightPunctual"),bn=function(){function e(){Object(V.a)(this,e),this._nodeLights=[]}return Object(B.a)(e,[{key:"name",get:function(){return"KHR_lights_punctual"}},{key:"register",value:function(e){console.log("Bind light extension handler"),e.node.add(this.name,{postParse:this._nodePostParse.bind(this)})}},{key:"unregister",value:function(e){e.scene.remove(this.name)}},{key:"postParse",value:function(){this._nodeLights.forEach((function(e){var t=e.node,a=e.data,n=t.findComponents("light").find((function(e){return e.entity.name===t.name&&e.entity.parent===t}));if(n){var i,r=.2*(null!==(i=a.intensity)&&void 0!==i?i:1);n.intensity=r}}))}},{key:"_nodePostParse",value:function(e,t,a){var n,i,r;gn("Parse light",e,t,a);var o=null===(n=a.extensions)||void 0===n||null===(i=n[this.name])||void 0===i||null===(r=i.lights)||void 0===r?void 0:r[t.light];o&&(gn("Found light",o),this._nodeLights.push({node:e,data:o}))}}]),e}(),yn=ga()("PlayCanvasGltfLoader"),_n=function(){function e(t){Object(V.a)(this,e),this._app=t,this._extensionRegistry=void 0,this._extensionRegistry=new Ja}var t,a;return Object(B.a)(e,[{key:"_loadAsset",value:(a=Object(c.a)(l.a.mark((function e(t,a){var n=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return yn("Load glTF asset",t,a),e.abrupt("return",new Promise((function(e,i){var r=n._app.assets,o=a?t:wa.path.join("../..",t),s=wa.path.getBasename(a||o),l=r.getByUrl(o);l||(l=new wa.Asset(s,"container",{url:o,filename:a||s},null,n._extensionRegistry.containerAssetOptions),r.add(l)),l.resource?e(l):(l.once("load",(function(t){return e(t)})),l.once("error",(function(e){return i(e)})),r.load(l))})));case 2:case"end":return e.stop()}}),e)}))),function(e,t){return a.apply(this,arguments)})},{key:"_createAnimations",value:function(e,t,a){var n=e.nodes,i=e.animationIndicesByNode,r=e.animations;return i.map((function(e,i){if(0===e.length)return[];var o=n[i],s=o.addComponent("anim");return s.loadStateGraph({layers:e.map((function(e){var a,n,i=null!==(a=null===(n=t[e])||void 0===n?void 0:n.playRate)&&void 0!==a?a:Ya;return{name:r[e].resource.name,states:[{name:wa.ANIM_STATE_START},{name:Yt.Loop,speed:i,loop:!0},{name:Yt.LoopReverse,speed:-i,loop:!0},{name:Yt.Once,speed:i,loop:!1},{name:Yt.OnceReverse,speed:-i,loop:!1}],transitions:[]}})),parameters:{}}),e.map((function(e){var t=r[e].resource;return{track:t,index:e,layer:s.findAnimationLayer(t.name)}})).filter((function(e){return!!e.layer})).map((function(e){var n,i,r,s=e.track,l=e.index,c=e.layer;if(c.states.slice(1,c.states.length).forEach((function(e){return c.assignAnimation(e,s)})),a.includes(l))return new Ca(o,c,l);var u=t[l],h=!1===(null!==(n=null==u?void 0:u.loop)&&void 0!==n?n:Ga)?Yt.Once:Yt.Loop,d=!1!==(null!==(i=null==u?void 0:u.autoPlay)&&void 0!==i?i:Za),p=null!==(r=null==u?void 0:u.startTime)&&void 0!==r?r:qa;return new Ca(o,c,l,h,d,p)}))})).reduce((function(e,t){return[].concat(Object(Lt.a)(e),Object(Lt.a)(t))}),[])}},{key:"_clearExtensions",value:function(){this._extensionRegistry.removeAll()}},{key:"_registerExtensions",value:function(e){var t=this;e.forEach((function(e){return e.register(t._extensionRegistry)}))}},{key:"_unregisterExtensions",value:function(e){var t=this;e.forEach((function(e){return e.unregister(t._extensionRegistry)}))}},{key:"_postParseExtensions",value:function(e,t){e.forEach((function(e){return e.postParse(t)}))}},{key:"_addModelMaterialMappings",value:function(e){var t=e.materials;this._app.assets.filter((function(e){var t;return"model"===e.type&&!!e.resource&&!(null===(t=e.data)||void 0===t?void 0:t.mapping)})).forEach((function(e){var a;e.data=null!==(a=e.data)&&void 0!==a?a:{},e.data.mapping=e.resource.meshInstances.map((function(e){var a;return{material:null===(a=t.find((function(t){return t.resource===e.material})))||void 0===a?void 0:a.id}}))}))}},{key:"load",value:(t=Object(c.a)(l.a.mark((function e(t,a){var n,i,r,o,s,c,u,h,d,p,m,v,f;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return yn("Load glTF asset",t,a),n=new dn,i=new ln,r=new mn,o=new on,s=new Xa,c=[n,i,r,o,s,new un,new tn,new fn,new $a,new bn],this._clearExtensions(),this._registerExtensions(c),e.prev=9,e.next=12,this._loadAsset(t,a);case 12:if(u=e.sent){e.next=15;break}throw new Error("Asset not found");case 15:if(h=u.resource){e.next=18;break}throw new Error("Asset is empty");case 18:if(yn("Loaded glTF container",h),d=h.scene){e.next=22;break}throw new Error("Asset has no default scene");case 22:return this._postParseExtensions(c,h),this._unregisterExtensions(c),p=s.getPlaybackByAnimationIndex(h),m=i.hotspotAnimationIndices,v=this._createAnimations(h,p,m),yn("Created animations",v),f=h.cameras.map((function(e){return Aa(e.entity)})),yn("Created camera entities",f),this._addModelMaterialMappings(h),yn("Added model material mappings"),e.abrupt("return",{asset:u,scenes:h.scenes.map((function(e){var t=v.filter((function(t){return e.findOne((function(e){return e===t.node}))}));return{root:e,levelVariantSets:n.getVariantSetsForScene(e,h),hotspots:i.getHotspotsForScene(e,t,h),backdrops:o.getBackdropsForScene(e,h),animations:t.filter((function(e){return-1===m.indexOf(e.index)})),cameras:f.filter((function(t){return e.findOne((function(e){return e===t}))}))}})),defaultScene:h.scenes.indexOf(d)});case 35:throw e.prev=35,e.t0=e.catch(9),this._unregisterExtensions(c),e.t0;case 39:case"end":return e.stop()}}),e,this,[[9,35]])}))),function(e,a){return t.apply(this,arguments)})},{key:"unload",value:function(e){yn("Unload glTF asset",e),this._app.assets.remove(e.asset),e.asset.unload()}}]),e}(),kn=ga()("PlayCanvasViewer"),Cn=function(){function e(t,a){var n,i,r=this;Object(V.a)(this,e),this.canvas=t,this._cameraPreviewSize=a,this._app=void 0,this._activeCamera=void 0,this._defaultCamera=void 0,this._loader=void 0,this._gltf=void 0,this._activeGltfScene=void 0,this._variantSetManager=void 0,this._hotspots=void 0,this._backdrops=void 0,this._cameraPreviews=void 0,this._debouncedCanvasResize=Va()((function(){return r._resizeCanvas(r._activeCamera)}),10),this._canvasResizeObserver=new za.a(this._debouncedCanvasResize),this._canvasSizeElem=void 0,this._initiated=!1,this._gltfLoaded=!1,this._noAnimations=void 0,this._resizeCanvas=this._resizeCanvas.bind(this);var o=new URLSearchParams(window.location.search);this._noAnimations=!!o.get("noAnimations"),this._app=this._createApp(),wa.registerScript(xa,"OrbitCamera"),wa.registerScript(Da,"AnimationHotspot"),wa.registerScript(Pa,"HdriBackdrop"),wa.registerScript(Ma,"NodeLightmap"),wa.registerScript(Ta,"SkySphere"),this._defaultCamera=this._createDefaultCamera(this._app),this._activeCamera=this._defaultCamera,this._loader=new _n(this._app),this._canvasSizeElem=null!==(n=null===(i=this.canvas.parentElement)||void 0===i?void 0:i.parentElement)&&void 0!==n?n:void 0,this._canvasSizeElem&&this._canvasResizeObserver.observe(this._canvasSizeElem),window.getStats=this._getStats.bind(this)}var t,a,n,i,r;return Object(B.a)(e,[{key:"app",get:function(){return this._app}},{key:"initiated",get:function(){return!!this._app.graphicsDevice&&this._initiated}},{key:"gltfLoaded",get:function(){return this._gltfLoaded}},{key:"activeSceneHierarchy",get:function(){var e=this,t=this._activeGltfScene;if(t)return{variantSetManager:this._variantSetManager,cameras:t.cameras.map((function(t,a){var n,i;return{id:a,name:t.name,type:Ra(t)?t.script.OrbitCamera.modeName:"Static",previewSource:null!==(n=null===(i=e._cameraPreviews)||void 0===i?void 0:i[a])&&void 0!==n?n:""}})),hasBackdrops:t.backdrops.length>0}}},{key:"_resizeCanvas",value:function(e){var t=this._app,a=this._canvasSizeElem;if(a){var n=a.clientWidth,i=a.clientHeight,r=null==e?void 0:e.camera,o=null==r?void 0:r.aspectRatioMode,s=null==r?void 0:r.aspectRatio;if(o===wa.ASPECT_MANUAL&&void 0!==s){var l=n/i;t.resizeCanvas(s>l?n:i*s,s>l?n/s:i)}else t.resizeCanvas(n,i)}else t.resizeCanvas()}},{key:"_createApp",value:function(){var e=wa.Application.getApplication();e&&(kn("Destroying existing app"),e.destroy()),kn("Creating app for target",this.canvas);var t=new wa.Application(this.canvas,{assetPrefix:"viewer/playcanvas/",mouse:new wa.Mouse(document.body),keyboard:new wa.Keyboard(window),graphicsDeviceOptions:{preserveDrawingBuffer:!1,antialias:!0,alpha:!0,preferWebGl2:!0,use3dPhysics:!1}});return kn("Starting app"),t.start(),t}},{key:"_getStats",value:function(){var e=this._app.stats,t=Math.round(e.vram.ib*(1/1024)*10)/10,a=Math.round(e.vram.tex*(1/1024)*10)/10,n=Math.round(e.vram.vb*(1/1024)*10)/10;return"VRAM: Triangles ".concat(t," KB, Textures ").concat(a," KB, Vertices ").concat(n," KB")}},{key:"_createDefaultCamera",value:function(e){kn("Creating default camera");var t=Aa(new wa.Entity("Default")),a=t.script.create(xa,{enabled:!1});return a.nearClipFactor=.002,a.farClipFactor=100,a.allowPan=!0,e.root.addChild(t),t}},{key:"_setSceneHierarchy",value:(r=Object(c.a)(l.a.mark((function e(t){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:kn("Set scene hierarchy",t),this._activeGltfScene&&this._app.root.removeChild(this._activeGltfScene.root),this._activeGltfScene=t,this._app.root.addChild(t.root),t.cameras.sort((function(e,t){var a=Ra(e);return a===Ra(t)?0:a?-1:1})),t.cameras.some(Ra)||t.cameras.unshift(this._defaultCamera),t.hotspots.length>0&&this._initHotspots(t.hotspots),t.levelVariantSets.length>0&&this._initVariantSets(t.levelVariantSets),t.backdrops.length>0&&this._initBackdrops(t.backdrops);case 9:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"_initCameraPreviews",value:(i=Object(c.a)(l.a.mark((function e(t,a,n){var i,r,o,s,c,u,h,d;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:kn("Init camera previews",t,a,n),(i=this._canvasSizeElem)&&(i.style.width="".concat(a,"px"),i.style.height="".concat(n,"px"),i.style.visibility="hidden"),r=[],o=Object(Ia.a)(t),e.prev=5,o.s();case 7:if((s=o.n()).done){e.next=22;break}return c=s.value,u=c.camera,h=Ra(c)?c.script.OrbitCamera:null,d=u.enabled,u.enabled=!0,h&&(h.enabled=!0),this._resizeCanvas(c),e.next=17,new Promise((function(e){requestAnimationFrame((function(){return e()}))}));case 17:r.push(this.canvas.toDataURL()),h&&(h.enabled=d),u.enabled=d;case 20:e.next=7;break;case 22:e.next=27;break;case 24:e.prev=24,e.t0=e.catch(5),o.e(e.t0);case 27:return e.prev=27,o.f(),e.finish(27);case 30:this._cameraPreviews=r,i&&(i.style.width="",i.style.height="",i.style.visibility="visible");case 32:case"end":return e.stop()}}),e,this,[[5,24,27,30]])}))),function(e,t,a){return i.apply(this,arguments)})},{key:"_destroyCameraPreviews",value:function(){kn("Destroy camera previews",this._cameraPreviews),this._cameraPreviews=void 0}},{key:"_initHotspots",value:function(e){this._destroyHotspots(),kn("Init hotspots",e),this._hotspots=e,this._hotspots.forEach((function(e){return e.enabled=!0}))}},{key:"_destroyHotspots",value:function(){this._hotspots&&(kn("Destroy hotspots",this._hotspots),this._hotspots.forEach((function(e){return e.enabled=!1})),this._hotspots=void 0)}},{key:"_initVariantSets",value:function(e){this._destroyVariantSets(),kn("Init variant sets",e),this._variantSetManager=new Ha(e)}},{key:"_destroyVariantSets",value:function(){this._variantSetManager&&(kn("Destroy variant sets",this._variantSetManager),this._variantSetManager=void 0)}},{key:"_initBackdrops",value:function(e){var t;kn("Init backdrops",e),this._destroyBackdrops();var a=this._app,n=a.assets.get(null!==(t=a._skyboxLast)&&void 0!==t?t:0),i=a.scene.skyboxIntensity;e.forEach((function(e){e.script.on("enable",(function(){return function(e){a.scene.setSkybox([null].concat(Object(Lt.a)(e.skyboxCubemaps))),a.scene.skyboxIntensity=e.skyboxIntensity}(e)})),e.script.on("disable",(function(){return a.setSkybox(n),void(a.scene.skyboxIntensity=i)})),e.script.enabled=!0})),this._backdrops=e}},{key:"_destroyBackdrops",value:function(){kn("Destroy backdrops",this._backdrops),this._backdrops&&(this._backdrops.forEach((function(e){e.cubemap.destroy(),e.skyboxCubemaps.forEach((function(e){return e.destroy()}))})),this._backdrops=void 0)}},{key:"_focusOrbitCamera",value:function(e){var t,a=null!==(t=e.focusEntity)&&void 0!==t?t:this._app.root;kn("Focus camera on entity",a),e.reset(0,0,0),e.focus(a,{frameModels:!0})}},{key:"destroy",value:function(){this.destroyGltf(),this._canvasSizeElem&&this._canvasResizeObserver.unobserve(this._canvasSizeElem),this._app.destroy()}},{key:"configure",value:(n=Object(c.a)(l.a.mark((function e(){var t,a,n,i=this;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return kn("Configuring app"),t=this._app,e.next=4,new Promise((function(e,a){var n=wa.path.join(t.assets.prefix,"config.json");t.configure(n,(function(n){n?a(n):t.preload((function(){t.setCanvasFillMode(wa.FILLMODE_NONE),e()}))}))}));case 4:if(!(a=this._app.scenes.list()[0])){e.next=10;break}return n=a.url,kn("Loading scene",n),e.next=10,new Promise((function(e,t){i._app.scenes.loadScene(n,(function(a){a?t(a):e()}))}));case 10:this._initiated=!0;case 11:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"destroyGltf",value:function(){kn("Destroy glTF",this._gltf),this._gltfLoaded=!1,this._activeGltfScene&&(this._app.root.removeChild(this._activeGltfScene.root),this._activeGltfScene=void 0,this._destroyVariantSets(),this._destroyBackdrops(),this._destroyCameraPreviews(),this._destroyHotspots()),this._gltf&&(this._loader.unload(this._gltf),this._gltf=void 0)}},{key:"initAnimations",value:function(){var e;kn("Init animations",null===(e=this._activeGltfScene)||void 0===e?void 0:e.animations);var t=this._activeGltfScene;t&&!this._noAnimations&&requestAnimationFrame((function(){return t.animations.forEach((function(e){return e.init()}))}))}},{key:"initCameraPreviews",value:(a=Object(c.a)(l.a.mark((function e(){var t,a,n,i,r,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((n=null!==(t=null===(a=this._activeGltfScene)||void 0===a?void 0:a.cameras)&&void 0!==t?t:[]).length>1)){e.next=5;break}return i=this._cameraPreviewSize,r=i.width,o=i.height,e.next=5,this._initCameraPreviews(n,2*r,2*o);case 5:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"setActiveAnimations",value:function(e){kn("Set active animations",e),this._activeGltfScene&&this._activeGltfScene.animations.forEach((function(t,a){e.includes(a)&&t.playable&&t.defaultState?t.play(t.defaultState):t.pause()}))}},{key:"setActiveCamera",value:function(e){kn("Set active camera",e),this._activeGltfScene&&(this._activeGltfScene.cameras.forEach((function(t,a){var n=a===e;t.camera.enabled=n,Ra(t)&&(t.script.OrbitCamera.enabled=n)})),this._activeCamera=this._activeGltfScene.cameras.find((function(e){return e.camera.enabled})),this._activeCamera===this._defaultCamera&&this._focusOrbitCamera(this._defaultCamera.script.OrbitCamera),this._resizeCanvas(this._activeCamera))}},{key:"resetCamera",value:function(e,t,a){this._app.root&&this._activeCamera&&Ra(this._activeCamera)&&this._activeCamera.script.OrbitCamera.reset(e,t,a)}},{key:"loadGltf",value:(t=Object(c.a)(l.a.mark((function e(t,a){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.destroyGltf(),kn("Load glTF",t,a),e.prev=2,e.next=5,this._loader.load(t,a);case 5:return this._gltf=e.sent,kn("Loaded glTF",this._gltf),e.next=9,this._setSceneHierarchy(this._gltf.scenes[this._gltf.defaultScene]);case 9:this._gltfLoaded=!0,e.next=16;break;case 12:throw e.prev=12,e.t0=e.catch(2),this._gltfLoaded=!0,e.t0;case 16:case"end":return e.stop()}}),e,this,[[2,12]])}))),function(e,a){return t.apply(this,arguments)})}]),e}(),wn=ga()("Viewer"),On=Object(be.a)((function(e){return{root:{height:"calc(100% + 4px)",width:"calc(100% + 4px)",outline:0},canvasWrapper:{position:"absolute",top:"50%",left:"50%",transform:"translateY(-50%) translateX(-50%)"},canvas:{outline:0},backdrop:{position:"absolute",zIndex:3,color:e.palette.common.white,backgroundColor:"rgba(0, 0, 0, 0.9)",transition:e.transitions.create(["opacity","background-color"],{duration:e.transitions.duration.shortest})+" !important"},backdropTransparent:{backgroundColor:"rgba(0, 0, 0, 0.2)"},backdropBorder:{border:"3px solid ".concat(e.palette.primary.main)},messageBox:{maxWidth:320}}})),En=Object(p.a)((function(e){var t,a=e.isError,r=void 0!==a&&a,o=e.isEmpty,s=void 0!==o&&o,h=e.isLoading,d=void 0!==h&&h,p=On(),m=Object(ye.a)(),v=q(),f=v.gltfStore,g=v.settingsStore,b=f.gltf,y=f.setGltf,_=f.setSceneHierarchy,k=f.camera,C=g.enableDragAndDrop,w=g.showUI,O=Object(n.useRef)(null),E=Object(n.useState)(),S=Object(u.a)(E,2),x=S[0],P=S[1],M=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=Object(n.useState)(!1),i=Object(u.a)(a,2),r=i[0],o=i[1],s=Object(n.useCallback)(function(){var t=Object(c.a)(l.a.mark((function t(a){var n,i,r;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=a.find(ae),i=a.filter((function(e){return!ae(e)})),n){t.next=6;break}return console.error("The dropped file type is not supported. Drop a gltf or glb file."),o(!0),t.abrupt("return");case 6:if(!(i.length>0&&".gltf"===$.a.extname(n.name))){t.next=12;break}return t.next=9,ee(n,i);case 9:t.t0=t.sent,t.next=13;break;case 12:t.t0=n;case 13:if(r=t.t0){t.next=18;break}return console.error("The dropped file could not be opened."),o(!0),t.abrupt("return");case 18:o(!1),e({name:$.a.basename(n.name,$.a.extname(n.name)),filePath:URL.createObjectURL(r),blobFileName:n.name});case 20:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),[e]),h=Object(K.a)({onDrop:s}),d=h.getRootProps,p=h.isDragActive;return t?[p,r,o,d]:[!1,!1,o,function(){return{}}]}(Object(n.useCallback)(y,[y]),C),j=Object(u.a)(M,4),L=j[0],D=j[1],T=j[2],A=j[3],R=X(),I=Object(u.a)(R,3),F=I[0],V=I[1],z=I[2],B=d||F,U=V||D||r,N=w&&(B||L||U||s),H=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=Object(n.useState)(e),a=Object(u.a)(t,2),i=a[0],r=a[1],o=Object(n.useCallback)((function(e){e.prevent=!0}),[]);return Object(n.useEffect)((function(){function e(){document.body.removeEventListener("keydown",o),document.body.removeEventListener("wheel",o),document.body.removeEventListener("mousedown",o)}return i?(document.body.addEventListener("keydown",o),document.body.addEventListener("wheel",o),document.body.addEventListener("mousedown",o)):e(),e}),[o,i]),[r]}(N),W=Object(u.a)(H,1)[0];return Object(n.useEffect)((function(){if(O.current){wn("Create viewer");var e=new Cn(O.current,{width:m.cameraPreviewWidth,height:m.cameraPreviewHeight});return z(Object(c.a)(l.a.mark((function t(){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return wn("Configure viewer start"),t.next=3,e.configure();case 3:P(e),window.viewer=e,wn("Configure viewer end");case 6:case"end":return t.stop()}}),t)})))),function(){wn("Destroy viewer"),window.viewer=void 0,e.destroy()}}}),[z,m.cameraPreviewHeight,m.cameraPreviewWidth]),Object(n.useEffect)((function(){if((null==x?void 0:x.initiated)&&b)return z(Object(c.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return wn("Load glTF start",b.filePath),_(),e.next=4,x.loadGltf(b.filePath,b.blobFileName);case 4:return x.initAnimations(),x.setActiveCamera(0),e.next=8,x.initCameraPreviews();case 8:wn("Load glTF end",b.filePath),x.activeSceneHierarchy&&(wn("Set scene hierachy",x.activeSceneHierarchy),_(x.activeSceneHierarchy));case 10:case"end":return e.stop()}}),e)})))),function(){wn("Destroy glTF"),x.destroyGltf(),wn("Unset scene hierachy"),_()}}),[z,x,b,_]),Object(n.useEffect)((function(){(null==x?void 0:x.initiated)&&k&&(wn("Set active camera",k),x.setActiveCamera(k.id))}),[x,k]),Object(n.useEffect)((function(){wn("Reset drop error state"),T(!1)}),[b,T,x]),Object(n.useEffect)((function(){wn("Prevent camera interaction",N),W(N)}),[N,W]),i.a.createElement("div",Object.assign({className:p.root},A()),i.a.createElement("div",{className:p.canvasWrapper},i.a.createElement("canvas",{className:p.canvas,ref:O})),i.a.createElement(ba.a,{className:Object(ge.a)(p.backdrop,(t={},Object(fe.a)(t,p.backdropTransparent,!B),Object(fe.a)(t,p.backdropBorder,L),t)),open:N},B?i.a.createElement(ya.a,null):U?i.a.createElement(_a.a,{className:p.messageBox},i.a.createElement(jt,{icon:"error",overline:"Oops!",title:"Unexpected issue"},"We tried our best but something went wrong when loading"," ",r?"assets":"the asset",". Check console for more details.")):s||L?i.a.createElement(_a.a,{className:p.messageBox},i.a.createElement(jt,{icon:"dragdrop",title:"Drop glTF file here"},"Drop a .gltf or .glb file with accompanying assets to view them.")):null))})),Sn=Object(be.a)((function(e){return{content:{padding:e.spacing(2,3)}}})),xn=Object(p.a)((function(e){var t,a=e.isError,r=Sn(),o=Object(ye.a)(),s=q().gltfStore,l=s.gltfs,c=s.gltf,h=s.levelVariantSetId,d=s.variantSetManager,p=s.sceneHierarchy,m=s.showLevelVariantSet,v=s.setGltf,f=Object(n.useState)("gltf-list"),g=Object(u.a)(f,2),b=g[0],y=g[1],_=Object(n.useRef)(),k=Object(n.useState)([]),C=Object(u.a)(k,2),w=C[0],O=C[1],E=void 0!==h?w[h]:void 0,S="left";if(Object(n.useEffect)((function(){return d&&O(d.levelVariantSets),function(){O([])}}),[d]),Object(n.useEffect)((function(){_.current=b})),Object(n.useEffect)((function(){y(c?E?"variant-set":"gltf-content":0===l.length?"none":"gltf-list")}),[c,E,l]),a)return i.a.createElement(pa,null);switch(b){case"none":return i.a.createElement(pa,null,i.a.createElement("div",{className:r.content},i.a.createElement(Oe,{duration:o.transitions.duration.standard},i.a.createElement(jt,{icon:"empty",overline:"Empty",title:"No options"},"This scene does not contain any configurable objects."))));case"gltf-list":return S="gltf-content"===_.current?"right":"left",i.a.createElement(pa,{title:"Select scene",appearDirection:S},i.a.createElement("div",{className:r.content,"data-testid":"gltf-list"},i.a.createElement(Vt,null,l.map((function(e,t){return i.a.createElement(Bt,{key:e.filePath,onClick:function(){v(e),y("gltf-content")},selected:c&&e.filePath===c.filePath,appear:i.a.createElement(Oe,{direction:S,delay:"left"===S?t*o.listAnimationDelay:(l.length-1-t)*o.listAnimationDelay})},e.name)})))));case"gltf-content":return S="variant-set"===_.current?"right":"left",c?i.a.createElement(pa,{title:null==c?void 0:c.name,appearDirection:S,onNavigateBack:l.length>1?function(){return y("gltf-list")}:void 0},p?i.a.createElement(aa,{gltf:c,appearDirection:S,variantSetManager:d,onLevelVariantSetSelect:m}):null):null;case"variant-set":return void 0!==h&&d?i.a.createElement(pa,{title:null==E?void 0:E.name,onNavigateBack:function(){return m(void 0)}},i.a.createElement(ea,{variantSets:null!==(t=null==E?void 0:E.variantSets)&&void 0!==t?t:[],manager:d})):null}})),Pn=a(141),Mn=Object(be.a)((function(e){return{root:{zIndex:2,position:"absolute",marginBottom:-e.spacing(1.5),bottom:e.spacing(2),left:e.spacing(2),display:"flex",flexDirection:"row"},label:{margin:e.spacing(2,2,.5,2)}}})),jn=Object(p.a)((function(){var e=q().gltfStore,t=Object(ye.a)(),a=e.cameras,n=e.camera,r=e.setCamera,o=Mn();return a.length<2?null:i.a.createElement(Pn.a,{className:o.root,"aria-label":"camera","data-testid":"camera-select",name:"camera-select",value:void 0!==n?n.id.toString():"",onChange:function(e){r(a.find((function(t){return t.id===parseInt(e.target.value,10)})))}},a.map((function(e,a){return i.a.createElement($e,{key:e.id,value:e.id.toString(),image:e.previewSource,type:e.type,appear:i.a.createElement(Oe,{delay:a*t.listAnimationDelay,direction:"up"})})})))})),Ln=Object(be.a)((function(e){return{"@global":{html:{height:"100%"},body:{height:"100%",margin:"0",overflow:"hidden"},"#root":{height:"100%"}},root:{height:"100%"},topbar:{position:"relative",boxSizing:"border-box",display:"flex",alignItems:"center",height:e.topbarHeight,paddingLeft:e.spacing(2),paddingRight:e.spacing(1),color:e.palette.text.secondary,backgroundColor:e.palette.background.paper,zIndex:1},topbarLogo:{flex:"0 0 40px",maxWidth:40,height:24,overflow:"visible"},topbarLogoImage:{height:"100%",objectFit:"contain",objectPosition:"left 50%"},topbarTitle:{flex:"1 1 auto",textAlign:"center"},topbarToggle:{display:"flex",flex:"0 0 40px",justifyContent:"flex-end"},main:{display:"flex",height:"calc(100% - ".concat(e.topbarHeight,"px)")},mainFullheight:{height:"100%"},viewport:{position:"relative",flexGrow:1,height:"100%",backgroundColor:e.palette.common.black,overflow:"hidden"},viewportWithVisibleSidebar:{transition:e.transitions.create("margin",{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.enteringScreen})},viewportWithHiddenSidebar:{marginRight:-1*e.sidebarWidth,transition:e.transitions.create("margin",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen})}}})),Dn=Object(p.a)((function(e){var t,a=e.isLoading,r=e.isError,o=Ln(),s=Object(ye.a)(),l=Object(_e.a)(s.breakpoints.down("xs")),c=q(),h=c.gltfStore,d=c.settingsStore,p=h.gltf,m=h.gltfs,v=d.showTopbar,f=d.showSidebar,g=d.showCameras,b=d.topbarTitle,y=d.topbarLogoUrl,_=d.showFpsMeter,k=Object(n.useState)(!1),C=Object(u.a)(k,2),w=C[0],O=C[1],E=0===m.length&&!p;return Object(n.useEffect)((function(){return O(!E&&!l)}),[E,l]),i.a.createElement("div",{className:o.root},v&&i.a.createElement("header",{className:o.topbar},i.a.createElement("div",{className:o.topbarLogo},y&&i.a.createElement("img",{className:o.topbarLogoImage,src:y,alt:"Logo"})),i.a.createElement(ke.a,{className:o.topbarTitle,variant:"body2"},void 0!==b&&i.a.createElement(i.a.Fragment,null,b,p&&b&&" - ",p&&p.name)),i.a.createElement("div",{className:o.topbarToggle},f&&i.a.createElement(va,{open:w,toggleOpen:O}))),i.a.createElement("main",{className:Object(ge.a)(o.main,Object(fe.a)({},o.mainFullheight,!v))},i.a.createElement("div",{className:Object(ge.a)(o.viewport,(t={},Object(fe.a)(t,o.viewportWithHiddenSidebar,f&&!w),Object(fe.a)(t,o.viewportWithVisibleSidebar,f&&w),t))},i.a.createElement(En,{isLoading:a,isError:r,isEmpty:E}),g&&i.a.createElement(jn,null),_&&i.a.createElement(Ce.a,{xsDown:!0},i.a.createElement(Rt,null))),f&&i.a.createElement(la,{open:w},i.a.createElement(xn,{isError:r}))))})),Tn=f(),An=Object(p.a)((function(){var e=q(),t=e.gltfStore,a=e.settingsStore,r=t.setGltfs,o=a.initFromConfig,s=X(),p=Object(u.a)(s,3),m=p[0],v=p[1],g=p[2],b=Object(n.useState)(Tn),y=Object(u.a)(b,2),_=y[0],k=y[1];return Object(n.useEffect)((function(){var e,t=(e=1500,new Promise((function(t){setTimeout((function(){return t()}),e)})));g(Object(c.a)(l.a.mark((function e(){var a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,re();case 2:return a=e.sent,k(f(a.theme)),e.next=6,t;case 6:o(a),r(a.assets);case 8:case"end":return e.stop()}}),e)}))))}),[r,g,o]),i.a.createElement(h.a,{theme:_},i.a.createElement(d.a,null),i.a.createElement(Dn,{isLoading:m,isError:v}))}));window.DracoDecoderModule=Object(o.createDecoderModule)(),Object(r.render)(i.a.createElement(Y,null,i.a.createElement(An,null)),document.getElementById("root"))}},[[83,1,2]]]);
//# sourceMappingURL=main.967f45a9.chunk.js.map